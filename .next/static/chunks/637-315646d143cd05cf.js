(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[637],{805:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});let n=(0,r(4294).A)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]])},817:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});let n=(0,r(4294).A)("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]])},2033:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});let n=(0,r(4294).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2274:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});let n=(0,r(4294).A)("FilePenLine",[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]])},5376:t=>{!function(){var e={675:function(t,e){"use strict";e.byteLength=function(t){var e=c(t),r=e[0],n=e[1];return(r+n)*3/4-n},e.toByteArray=function(t){var e,r,i=c(t),a=i[0],s=i[1],u=new o((a+s)*3/4-s),f=0,h=s>0?a-4:a;for(r=0;r<h;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],u[f++]=e>>16&255,u[f++]=e>>8&255,u[f++]=255&e;return 2===s&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,u[f++]=255&e),1===s&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,u[f++]=e>>8&255,u[f++]=255&e),u},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,i=[],a=0,s=n-o;a<s;a+=16383)i.push(function(t,e,n){for(var o,i=[],a=e;a<n;a+=3)o=(t[a]<<16&0xff0000)+(t[a+1]<<8&65280)+(255&t[a+2]),i.push(r[o>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return i.join("")}(t,a,a+16383>s?s:a+16383));return 1===o?i.push(r[(e=t[n-1])>>2]+r[e<<4&63]+"=="):2===o&&i.push(r[(e=(t[n-2]<<8)+t[n-1])>>10]+r[e>>4&63]+r[e<<2&63]+"="),i.join("")};for(var r=[],n=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=i.length;a<s;++a)r[a]=i[a],n[i.charCodeAt(a)]=a;function c(t){var e=t.length;if(e%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");-1===r&&(r=e);var n=r===e?0:4-r%4;return[r,n]}n[45]=62,n[95]=63},72:function(t,e,r){"use strict";var n=r(675),o=r(783),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(t){if(t>0x7fffffff)throw RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,r){if("number"==typeof t){if("string"==typeof e)throw TypeError('The "string" argument must be of type string. Received type number');return f(t)}return c(t,e,r)}function c(t,e,r){if("string"==typeof t){var n=t,o=e;if(("string"!=typeof o||""===o)&&(o="utf8"),!s.isEncoding(o))throw TypeError("Unknown encoding: "+o);var i=0|l(n,o),c=a(i),u=c.write(n,o);return u!==i&&(c=c.slice(0,u)),c}if(ArrayBuffer.isView(t))return h(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(A(t,ArrayBuffer)||t&&A(t.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(A(t,SharedArrayBuffer)||t&&A(t.buffer,SharedArrayBuffer)))return function(t,e,r){var n;if(e<0||t.byteLength<e)throw RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),s.prototype),n}(t,e,r);if("number"==typeof t)throw TypeError('The "value" argument must not be of type number. Received type number');var f=t.valueOf&&t.valueOf();if(null!=f&&f!==t)return s.from(f,e,r);var d=function(t){if(s.isBuffer(t)){var e=0|p(t.length),r=a(e);return 0===r.length||t.copy(r,0,0,e),r}return void 0!==t.length?"number"!=typeof t.length||function(t){return t!=t}(t.length)?a(0):h(t):"Buffer"===t.type&&Array.isArray(t.data)?h(t.data):void 0}(t);if(d)return d;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,r);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw TypeError('"size" argument must be of type number');if(t<0)throw RangeError('The value "'+t+'" is invalid for option "size"')}function f(t){return u(t),a(t<0?0:0|p(t))}function h(t){for(var e=t.length<0?0:0|p(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}e.Buffer=s,e.SlowBuffer=function(t){return+t!=t&&(t=0),s.alloc(+t)},e.INSPECT_MAX_BYTES=50,e.kMaxLength=0x7fffffff,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,r){return c(t,e,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,r){return(u(t),t<=0)?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)},s.allocUnsafe=function(t){return f(t)},s.allocUnsafeSlow=function(t){return f(t)};function p(t){if(t>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|t}function l(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||A(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return M(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return S(t).length;default:if(o)return n?-1:M(t).length;e=(""+e).toLowerCase(),o=!0}}function d(t,e,r){var o,i,a,s=!1;if((void 0===e||e<0)&&(e=0),e>this.length||((void 0===r||r>this.length)&&(r=this.length),r<=0||(r>>>=0)<=(e>>>=0)))return"";for(t||(t="utf8");;)switch(t){case"hex":return function(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=e;i<r;++i)o+=F[t[i]];return o}(this,e,r);case"utf8":case"utf-8":return y(this,e,r);case"ascii":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(127&t[o]);return n}(this,e,r);case"latin1":case"binary":return function(t,e,r){var n="";r=Math.min(t.length,r);for(var o=e;o<r;++o)n+=String.fromCharCode(t[o]);return n}(this,e,r);case"base64":return o=this,i=e,a=r,0===i&&a===o.length?n.fromByteArray(o):n.fromByteArray(o.slice(i,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(t,e,r){for(var n=t.slice(e,r),o="",i=0;i<n.length;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}(this,e,r);default:if(s)throw TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),s=!0}}function v(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function m(t,e,r,n,o){var i;if(0===t.length)return -1;if("string"==typeof r?(n=r,r=0):r>0x7fffffff?r=0x7fffffff:r<-0x80000000&&(r=-0x80000000),(i=r*=1)!=i&&(r=o?0:t.length-1),r<0&&(r=t.length+r),r>=t.length)if(o)return -1;else r=t.length-1;else if(r<0)if(!o)return -1;else r=0;if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:g(t,e,r,n,o);if("number"==typeof e){if(e&=255,"function"==typeof Uint8Array.prototype.indexOf)if(o)return Uint8Array.prototype.indexOf.call(t,e,r);else return Uint8Array.prototype.lastIndexOf.call(t,e,r);return g(t,[e],r,n,o)}throw TypeError("val must be string, number or Buffer")}function g(t,e,r,n,o){var i,a=1,s=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return -1;a=2,s/=2,c/=2,r/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){var f=-1;for(i=r;i<s;i++)if(u(t,i)===u(e,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===c)return f*a}else -1!==f&&(i-=i-f),f=-1}else for(r+c>s&&(r=s-c),i=r;i>=0;i--){for(var h=!0,p=0;p<c;p++)if(u(t,i+p)!==u(e,p)){h=!1;break}if(h)return i}return -1}s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(A(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),A(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,o=0,i=Math.min(r,n);o<i;++o)if(t[o]!==e[o]){r=t[o],n=e[o];break}return r<n?-1:+(n<r)},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);if(void 0===e)for(r=0,e=0;r<t.length;++r)e+=t[r].length;var r,n=s.allocUnsafe(e),o=0;for(r=0;r<t.length;++r){var i=t[r];if(A(i,Uint8Array)&&(i=s.from(i)),!s.isBuffer(i))throw TypeError('"list" argument must be an Array of Buffers');i.copy(n,o),o+=i.length}return n},s.byteLength=l,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0==arguments.length?y(this,0,t):d.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},i&&(s.prototype[i]=s.prototype.inspect),s.prototype.compare=function(t,e,r,n,o){if(A(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),e<0||r>t.length||n<0||o>this.length)throw RangeError("out of range index");if(n>=o&&e>=r)return 0;if(n>=o)return -1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,o>>>=0,this===t)return 0;for(var i=o-n,a=r-e,c=Math.min(i,a),u=this.slice(n,o),f=t.slice(e,r),h=0;h<c;++h)if(u[h]!==f[h]){i=u[h],a=f[h];break}return i<a?-1:+(a<i)},s.prototype.includes=function(t,e,r){return -1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return m(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return m(this,t,e,r,!1)};function y(t,e,r){r=Math.min(t.length,r);for(var n=[],o=e;o<r;){var i,a,s,c,u=t[o],f=null,h=u>239?4:u>223?3:u>191?2:1;if(o+h<=r)switch(h){case 1:u<128&&(f=u);break;case 2:(192&(i=t[o+1]))==128&&(c=(31&u)<<6|63&i)>127&&(f=c);break;case 3:i=t[o+1],a=t[o+2],(192&i)==128&&(192&a)==128&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(f=c);break;case 4:i=t[o+1],a=t[o+2],s=t[o+3],(192&i)==128&&(192&a)==128&&(192&s)==128&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(f=c)}null===f?(f=65533,h=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),o+=h}var p=n,l=p.length;if(l<=4096)return String.fromCharCode.apply(String,p);for(var d="",v=0;v<l;)d+=String.fromCharCode.apply(String,p.slice(v,v+=4096));return d}function b(t,e,r){if(t%1!=0||t<0)throw RangeError("offset is not uint");if(t+e>r)throw RangeError("Trying to access beyond buffer length")}function _(t,e,r,n,o,i){if(!s.isBuffer(t))throw TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw RangeError('"value" argument is out of bounds');if(r+n>t.length)throw RangeError("Index out of range")}function w(t,e,r,n,o,i){if(r+n>t.length||r<0)throw RangeError("Index out of range")}function x(t,e,r,n,i){return e*=1,r>>>=0,i||w(t,e,r,4,34028234663852886e22,-34028234663852886e22),o.write(t,e,r,n,23,4),r+4}function E(t,e,r,n,i){return e*=1,r>>>=0,i||w(t,e,r,8,17976931348623157e292,-17976931348623157e292),o.write(t,e,r,n,52,8),r+8}s.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else if(isFinite(e))e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var o,i,a,s,c,u,f,h,p=this.length-e;if((void 0===r||r>p)&&(r=p),t.length>0&&(r<0||e<0)||e>this.length)throw RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var l=!1;;)switch(n){case"hex":return function(t,e,r,n){r=Number(r)||0;var o=t.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=e.length;n>i/2&&(n=i/2);for(var a=0;a<n;++a){var s,c=parseInt(e.substr(2*a,2),16);if((s=c)!=s)break;t[r+a]=c}return a}(this,t,e,r);case"utf8":case"utf-8":return o=e,i=r,T(M(t,this.length-o),this,o,i);case"ascii":return a=e,s=r,T(D(t),this,a,s);case"latin1":case"binary":return function(t,e,r,n){return T(D(e),t,r,n)}(this,t,e,r);case"base64":return c=e,u=r,T(S(t),this,c,u);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return f=e,h=r,T(function(t,e){for(var r,n,o=[],i=0;i<t.length&&!((e-=2)<0);++i)n=(r=t.charCodeAt(i))>>8,o.push(r%256),o.push(n);return o}(t,this.length-f),this,f,h);default:if(l)throw TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),l=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},s.prototype.slice=function(t,e){var r=this.length;t=~~t,e=void 0===e?r:~~e,t<0?(t+=r)<0&&(t=0):t>r&&(t=r),e<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n},s.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t+--e],o=1;e>0&&(o*=256);)n+=this[t+--e]*o;return n},s.prototype.readUInt8=function(t,e){return t>>>=0,e||b(t,1,this.length),this[t]},s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||b(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+0x1000000*this[t+3]},s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),0x1000000*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=this[t],o=1,i=0;++i<e&&(o*=256);)n+=this[t+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||b(t,e,this.length);for(var n=e,o=1,i=this[t+--n];n>0&&(o*=256);)i+=this[t+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*e)),i},s.prototype.readInt8=function(t,e){return(t>>>=0,e||b(t,1,this.length),128&this[t])?-((255-this[t]+1)*1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?0xffff0000|r:r},s.prototype.readInt16BE=function(t,e){t>>>=0,e||b(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?0xffff0000|r:r},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||b(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||b(t,4,this.length),o.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||b(t,4,this.length),o.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||b(t,8,this.length),o.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||b(t,8,this.length),o.read(this,t,!1,52,8)},s.prototype.writeUIntLE=function(t,e,r,n){if(t*=1,e>>>=0,r>>>=0,!n){var o=Math.pow(2,8*r)-1;_(this,t,e,r,o,0)}var i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},s.prototype.writeUIntBE=function(t,e,r,n){if(t*=1,e>>>=0,r>>>=0,!n){var o=Math.pow(2,8*r)-1;_(this,t,e,r,o,0)}var i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},s.prototype.writeUInt8=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUInt16LE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUInt16BE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUInt32LE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,4,0xffffffff,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUInt32BE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,4,0xffffffff,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,r,n){if(t*=1,e>>>=0,!n){var o=Math.pow(2,8*r-1);_(this,t,e,r,o-1,-o)}var i=0,a=1,s=0;for(this[e]=255&t;++i<r&&(a*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/a|0)-s&255;return e+r},s.prototype.writeIntBE=function(t,e,r,n){if(t*=1,e>>>=0,!n){var o=Math.pow(2,8*r-1);_(this,t,e,r,o-1,-o)}var i=r-1,a=1,s=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/a|0)-s&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,4,0x7fffffff,-0x80000000),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,r){return t*=1,e>>>=0,r||_(this,t,e,4,0x7fffffff,-0x80000000),t<0&&(t=0xffffffff+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,r){return x(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return x(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return E(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return E(this,t,e,!1,r)},s.prototype.copy=function(t,e,r,n){if(!s.isBuffer(t))throw TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r||0===t.length||0===this.length)return 0;if(e<0)throw RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw RangeError("Index out of range");if(n<0)throw RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var o=n-r;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(e,r,n);else if(this===t&&r<e&&e<n)for(var i=o-1;i>=0;--i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,n),e);return o},s.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw TypeError("Unknown encoding: "+n);if(1===t.length){var o,i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw RangeError("Out of range index");if(r<=e)return this;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=s.isBuffer(t)?t:s.from(t,n),c=a.length;if(0===c)throw TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<r-e;++o)this[o+e]=a[o%c]}return this};var P=/[^+/0-9A-Za-z-_]/g;function M(t,e){e=e||1/0;for(var r,n=t.length,o=null,i=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!o){if(r>56319||a+1===n){(e-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(e-=3)>-1&&i.push(239,191,189),o=r;continue}r=(o-55296<<10|r-56320)+65536}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((e-=1)<0)break;i.push(r)}else if(r<2048){if((e-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else if(r<1114112){if((e-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}else throw Error("Invalid code point")}return i}function D(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function S(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function T(t,e,r,n){for(var o=0;o<n&&!(o+r>=e.length)&&!(o>=t.length);++o)e[o+r]=t[o];return o}function A(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}var F=function(){for(var t="0123456789abcdef",e=Array(256),r=0;r<16;++r)for(var n=16*r,o=0;o<16;++o)e[n+o]=t[r]+t[o];return e}()},783:function(t,e){e.read=function(t,e,r,n,o){var i,a,s=8*o-n-1,c=(1<<s)-1,u=c>>1,f=-7,h=r?o-1:0,p=r?-1:1,l=t[e+h];for(h+=p,i=l&(1<<-f)-1,l>>=-f,f+=s;f>0;i=256*i+t[e+h],h+=p,f-=8);for(a=i&(1<<-f)-1,i>>=-f,f+=n;f>0;a=256*a+t[e+h],h+=p,f-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(l?-1:1);a+=Math.pow(2,n),i-=u}return(l?-1:1)*a*Math.pow(2,i-n)},e.write=function(t,e,r,n,o,i){var a,s,c,u=8*i-o-1,f=(1<<u)-1,h=f>>1,p=5960464477539062e-23*(23===o),l=n?0:i-1,d=n?1:-1,v=+(e<0||0===e&&1/e<0);for(isNaN(e=Math.abs(e))||e===1/0?(s=+!!isNaN(e),a=f):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),a+h>=1?e+=p/c:e+=p*Math.pow(2,1-h),e*c>=2&&(a++,c/=2),a+h>=f?(s=0,a=f):a+h>=1?(s=(e*c-1)*Math.pow(2,o),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,o),a=0));o>=8;t[r+l]=255&s,l+=d,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;t[r+l]=255&a,l+=d,a/=256,u-=8);t[r+l-d]|=128*v}}},r={};function n(t){var o=r[t];if(void 0!==o)return o.exports;var i=r[t]={exports:{}},a=!0;try{e[t](i,i.exports,n),a=!1}finally{a&&delete r[t]}return i.exports}n.ab="//",t.exports=n(72)}()},9007:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});let n=(0,r(4294).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},9338:(t,e,r)=>{"use strict";r.d(e,{A:()=>n});let n=(0,r(4294).A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]])},9362:(t,e,r)=>{"use strict";r.d(e,{ex:()=>ei,R:()=>eR,$2:()=>s,a4:()=>ez,L0:()=>tc,B0:()=>e_,Lz:()=>function t(e,r){var n=new m(r.width,r.height),o=n.width,i=n.height;if(o<=0||i<=0)throw Error("resizeResults - invalid dimensions: "+JSON.stringify({width:o,height:i}));if(Array.isArray(e))return e.map(function(e){return t(e,{width:o,height:i})});if(tk(e)){var a=e.detection.forSize(o,i),s=e.unshiftedLandmarks.forSize(a.box.width,a.box.height);return tI(z(e,a),s)}return R(e)?z(e,e.detection.forSize(o,i)):e instanceof k||e instanceof A?e.forSize(o,i):e}});var n,o,i,a,s={};r.r(s),r.d(s,{AnchorPosition:()=>o,DrawBox:()=>$,DrawBoxOptions:()=>K,DrawFaceLandmarks:()=>tL,DrawFaceLandmarksOptions:()=>tj,DrawTextField:()=>H,DrawTextFieldOptions:()=>Z,drawContour:()=>u,drawDetections:()=>X,drawFaceExpressions:()=>tC,drawFaceLandmarks:()=>tW});var c=r(4670);function u(t,e,r){if(void 0===r&&(r=!1),t.beginPath(),e.slice(1).forEach(function(r,n){var o=r.x,i=r.y,a=e[n];t.moveTo(a.x,a.y),t.lineTo(o,i)}),r){var n=e[e.length-1],o=e[0];if(!n||!o)return;t.moveTo(n.x,n.y),t.lineTo(o.x,o.y)}t.stroke()}var f=function(t,e){return(f=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function h(t,e){function r(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var p=function(){return(p=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function l(t,e,r,n){return new(r||(r=Promise))(function(o,i){function a(t){try{c(n.next(t))}catch(t){i(t)}}function s(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(a,s)}c((n=n.apply(t,e||[])).next())})}function d(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){var c=[i,s];if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}function v(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var n=Array(t),o=0,e=0;e<r;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,o++)n[o]=i[a];return n}var m=function(){function t(t,e){if(!E(t)||!E(e))throw Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.reverse=function(){return new t(1/this.width,1/this.height)},t}();function g(t,e){return t instanceof c.qYS&&t.shape.length===e}function y(t){return g(t,4)}function b(t,e){void 0===e&&(e=2);var r=Math.pow(10,e);return Math.floor(t*r)/r}function _(t){return t&&t.width&&t.height}function w(t){return t.reduce(function(t,e){return t.add(e)},new M(0,0)).div(new M(t.length,t.length))}function x(t,e,r){return Array(t).fill(0).map(function(t,n){return e+n*r})}function E(t){return!!t&&t!==1/0&&t!==-1/0&&!isNaN(t)||0===t}function P(t){return E(t)&&0<=t&&t<=1}var M=function(){function t(t,e){this._x=t,this._y=e}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.sub=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.mul=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.div=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.abs=function(){return new t(Math.abs(this.x),Math.abs(this.y))},t.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t}(),D=function(){function t(e,r){void 0===r&&(r=!0);var n=e||{},o=[n.left,n.top,n.right,n.bottom].every(E),i=[n.x,n.y,n.width,n.height].every(E);if(!i&&!o)throw Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var a=i?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],s=a[0],c=a[1],u=a[2],f=a[3];t.assertIsValidBox({x:s,y:c,width:u,height:f},"Box.constructor",r),this._x=s,this._y=c,this._width=u,this._height=f}return t.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(E)},t.assertIsValidBox=function(e,r,n){if(void 0===n&&(n=!1),!t.isRect(e))throw Error(r+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw Error(r+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topLeft",{get:function(){return new M(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"topRight",{get:function(){return new M(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomLeft",{get:function(){return new M(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottomRight",{get:function(){return new M(this.right,this.bottom)},enumerable:!0,configurable:!0}),t.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.round(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(t){return Math.floor(t)});return new t({x:e[0],y:e[1],width:e[2],height:e[3]})},t.prototype.toSquare=function(){var e=this.x,r=this.y,n=this.width,o=this.height,i=Math.abs(n-o);return n<o&&(e-=i/2,n+=i),o<n&&(r-=i/2,o+=i),new t({x:e,y:r,width:n,height:o})},t.prototype.rescale=function(e){var r=_(e)?e.width:e,n=_(e)?e.height:e;return new t({x:this.x*r,y:this.y*n,width:this.width*r,height:this.height*n})},t.prototype.pad=function(e,r){var n=[this.x-e/2,this.y-r/2,this.width+e,this.height+r];return new t({x:n[0],y:n[1],width:n[2],height:n[3]})},t.prototype.clipAtImageBorders=function(e,r){var n=this.x,o=this.y,i=this.right,a=this.bottom,s=Math.max(n,0),c=Math.max(o,0),u=Math.min(i-s,e-s),f=Math.min(a-c,r-c);return new t({x:s,y:c,width:u,height:f}).floor()},t.prototype.shift=function(e,r){var n=this.width,o=this.height;return new t({x:this.x+e,y:this.y+r,width:n,height:o})},t.prototype.padAtBorders=function(t,e){var r=this.width+1,n=this.height+1,o=r,i=n,a=this.left,s=this.top,c=this.right,u=this.bottom;return c>e&&(o=-c+e+r,c=e),u>t&&(i=-u+t+n,u=t),a<1&&(i=2-a,a=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:o,y:s,ey:u,x:a,ex:c,w:r,h:n}},t.prototype.calibrate=function(e){return new t({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},t}(),S=function(t){function e(e,r,n,o,i){return void 0===i&&(i=!1),t.call(this,{left:e,top:r,right:n,bottom:o},i)||this}return h(e,t),e}(D),T=function(){function t(t,e,r,n,o){this._imageDims=new m(o.width,o.height),this._score=t,this._classScore=e,this._className=r,this._box=new D(n).rescale(this._imageDims)}return Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativeBox",{get:function(){return new D(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),t.prototype.forSize=function(e,r){return new t(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:r})},t}(),A=function(t){function e(e,r,n){return t.call(this,e,e,"",r,n)||this}return h(e,t),e.prototype.forSize=function(r,n){var o=t.prototype.forSize.call(this,r,n);return new e(o.score,o.relativeBox,o.imageDims)},e}(T);function F(t,e,r,n){void 0===n&&(n=!0);for(var o=e.map(function(t,e){return{score:t,boxIndex:e}}).sort(function(t,e){return t.score-e.score}).map(function(t){return t.boxIndex}),i=[];o.length>0;)!function(){var e=o.pop();i.push(e);for(var a=o,s=[],c=0;c<a.length;c++){var u=a[c],f=t[e],h=t[u];s.push(function(t,e,r){void 0===r&&(r=!0);var n=Math.max(0,Math.min(t.right,e.right)-Math.max(t.left,e.left))*Math.max(0,Math.min(t.bottom,e.bottom)-Math.max(t.top,e.top));return r?n/(t.area+e.area-n):n/Math.min(t.area,e.area)}(f,h,n))}o=o.filter(function(t,e){return s[e]<=r})}();return i}function O(t,e){return c.DZQ(function(){var r=e[0],n=e[1],o=e[2],i=c.GSj(v(t.shape.slice(0,3),[1]),r),a=c.GSj(v(t.shape.slice(0,3),[1]),n),s=c.GSj(v(t.shape.slice(0,3),[1]),o),u=c.xWs([i,a,s],3);return c.jbE(t,u)})}function B(t){return 1/(1+Math.exp(-t))}var C=function(t){function e(e,r,n,o,i){return void 0===i&&(i=!1),t.call(this,{x:e,y:r,width:n,height:o},i)||this}return h(e,t),e}(D),k=function(){function t(t,e,r){void 0===r&&(r=new M(0,0));var n=e.width,o=e.height;this._imgDims=new m(n,o),this._shift=r,this._positions=t.map(function(t){return t.mul(new M(n,o)).add(r)})}return Object.defineProperty(t.prototype,"shift",{get:function(){return new M(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new M(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),t.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},t.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new M(t,e))},t.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},t.prototype.align=function(t,e){if(void 0===e&&(e={}),t){var r=t instanceof A?t.box.floor():new D(t);return this.shiftBy(r.x,r.y).align(null,e)}var n=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=n.useDlibAlignment,i=n.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},t.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],r=t[1],n=t[2],o=function(t){return n.sub(t).magnitude()},i=Math.floor((o(e)+o(r))/2/.45),a=w(t),s=Math.floor(Math.max(0,a.x-.5*i)),c=Math.floor(Math.max(0,a.y-.43*i));return new C(s,c,Math.min(i,this.imageWidth+s),Math.min(i,this.imageHeight+c))},t.prototype.alignMinBbox=function(t){var e,r,n,o=(r=(e=this.positions).map(function(t){return t.x}),n=e.map(function(t){return t.y}),new S(r.reduce(function(t,e){return e<t?e:t},1/0),n.reduce(function(t,e){return e<t?e:t},1/0),r.reduce(function(t,e){return t<e?e:t},0),n.reduce(function(t,e){return t<e?e:t},0)));return o.pad(o.width*t,o.height*t)},t.prototype.getRefPointsForAlignment=function(){throw Error("getRefPointsForAlignment not implemented by base class")},t}(),I=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],w([t[3],t[4]])]},e}(k),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(w)},e}(k),L=function(){function t(t,e){this._label=t,this._distance=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){return void 0===t&&(t=!0),""+this.label+(t?" ("+b(this.distance)+")":"")},t}(),W=function(t){function e(e,r){var n=t.call(this,e)||this;return n._label=r,n}return h(e,t),e.assertIsValidLabeledBox=function(t,e){if(D.assertIsValidBox(t,e),!E(t.label))throw Error(e+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e}(D),N=function(){function t(t,e){if("string"!=typeof t)throw Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(t){return!(t instanceof Float32Array)}))throw Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},t.fromJSON=function(e){var r=e.descriptors.map(function(t){return new Float32Array(t)});return new t(e.label,r)},t}();function R(t){return t.detection instanceof A}function z(t,e){return Object.assign({},t,{detection:e})}!function(t){function e(e,r,n,o){var i=t.call(this,e,r)||this;return i._score=n,i._classScore=o,i}h(e,t),e.assertIsValidPredictedBox=function(t,e){if(W.assertIsValidLabeledBox(t,e),!P(t.score)||!P(t.classScore))throw Error(e+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0})}(W);var Q=r(5704);function V(){return"object"==typeof r.g&&void 0!==Q&&!!Q.version}var U={getEnv:function(){if(!n)throw Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return n},isNodejs:V};function q(t){return U.isNodejs()||"string"!=typeof t?t:document.getElementById(t)}function G(t){var e=U.getEnv(),r=e.Canvas;if(t instanceof e.CanvasRenderingContext2D)return t;var n=q(t);if(!(n instanceof r))throw Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=n.getContext("2d");if(!o)throw Error("resolveContext2d - canvas 2d context is null");return o}(function(){var t,e,o,i;"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D&&(n={Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:window.fetch||function(){throw Error("fetch - missing fetch implementation for browser environment")},readFile:function(){throw Error("readFile - filesystem not available for browser environment")}}),V()&&(t=r.g.Canvas||r.g.HTMLCanvasElement,e=r.g.Image||r.g.HTMLImageElement,o=r.g.fetch||function(){throw Error("fetch - missing fetch implementation for nodejs environment")},i=function(t){var e="";if(!t)try{t=r(1591)}catch(t){e=t.toString()}return{readFile:t?function(e){return new Promise(function(r,n){t.readFile(e,function(t,e){return t?n(t):r(e)})})}:function(){throw Error("readFile - failed to require fs in nodejs environment with error: "+e)}}}(),n=p({Canvas:t||function(){},CanvasRenderingContext2D:r.g.CanvasRenderingContext2D||function(){},Image:e||function(){},ImageData:r.g.ImageData||function(){},Video:r.g.HTMLVideoElement||function(){},createCanvasElement:function(){if(t)return new t;throw Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(e)return new e;throw Error("createImageElement - missing Image implementation for nodejs environment")},fetch:o},i))})(),function(t){t.TOP_LEFT="TOP_LEFT",t.TOP_RIGHT="TOP_RIGHT",t.BOTTOM_LEFT="BOTTOM_LEFT",t.BOTTOM_RIGHT="BOTTOM_RIGHT"}(o||(o={}));var Z=function(t){void 0===t&&(t={});var e=t.anchorPosition,r=t.backgroundColor,n=t.fontColor,i=t.fontSize,a=t.fontStyle,s=t.padding;this.anchorPosition=e||o.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=n||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=a||"Georgia",this.padding=s||4},H=function(){function t(e,r,n){void 0===n&&(n={}),this.text="string"==typeof e?[e]:e instanceof t?e.text:e,this.anchor=r,this.options=new Z(n)}return t.prototype.measureWidth=function(t){var e=this.options.padding;return this.text.map(function(e){return t.measureText(e).width}).reduce(function(t,e){return t<e?e:t},0)+2*e},t.prototype.measureHeight=function(){var t=this.options,e=t.fontSize,r=t.padding;return this.text.length*e+2*r},t.prototype.getUpperLeft=function(t,e){var r=this.options.anchorPosition,n=r===o.BOTTOM_RIGHT||r===o.TOP_RIGHT,i=r===o.BOTTOM_LEFT||r===o.BOTTOM_RIGHT,a=this.measureWidth(t),s=this.measureHeight(),c=n?this.anchor.x-a:this.anchor.x,u=i?this.anchor.y-s:this.anchor.y;return e?{x:Math.max(Math.min(c,e.width-a),0),y:Math.max(Math.min(u,e.height-s),0)}:{x:c,y:u}},t.prototype.draw=function(t){var e=q(t),r=G(e),n=this.options,o=n.backgroundColor,i=n.fontColor,a=n.fontSize,s=n.fontStyle,c=n.padding;r.font=a+"px "+s;var u=this.measureWidth(r),f=this.measureHeight();r.fillStyle=o;var h=this.getUpperLeft(r,e);r.fillRect(h.x,h.y,u,f),r.fillStyle=i,this.text.forEach(function(t,e){var n=c+h.x,o=c+h.y+(e+1)*a;r.fillText(t,n,o)})},t}(),K=function(t){void 0===t&&(t={});var e=t.boxColor,r=t.lineWidth,n=t.label,i=t.drawLabelOptions;this.boxColor=e||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=n;var a={anchorPosition:o.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new Z(Object.assign({},a,i))},$=function(){function t(t,e){void 0===e&&(e={}),this.box=new D(t),this.options=new K(e)}return t.prototype.draw=function(t){var e=G(t),r=this.options,n=r.boxColor,o=r.lineWidth,i=this.box,a=i.x,s=i.y,c=i.width,u=i.height;e.strokeStyle=n,e.lineWidth=o,e.strokeRect(a,s,c,u);var f=this.options.label;f&&new H([f],{x:a-o/2,y:s},this.options.drawLabelOptions).draw(t)},t}();function X(t,e){(Array.isArray(e)?e:[e]).forEach(function(e){var r=e instanceof A?e.score:R(e)?e.detection.score:void 0;new $(e instanceof A?e.box:R(e)?e.detection.box:new D(e),{label:r?""+b(r):void 0}).draw(t)})}function Y(t){var e=U.getEnv(),r=e.Image,n=e.Video;return t instanceof r&&t.complete||t instanceof n&&t.readyState>=3}function J(t){var e=U.getEnv(),r=e.Image,n=e.Video;return t instanceof r?new m(t.naturalWidth,t.naturalHeight):t instanceof n?new m(t.videoWidth,t.videoHeight):new m(t.width,t.height)}function tt(t){var e=t.width,r=t.height,n=(0,U.getEnv().createCanvasElement)();return n.width=e,n.height=r,n}function te(t,e){var r=U.getEnv().ImageData;if(!(t instanceof r)&&!Y(t))throw Error("createCanvasFromMedia - media has not finished loading yet");var n=e||J(t),o=n.width,i=n.height,a=tt({width:o,height:i});return t instanceof r?G(a).putImageData(t,0,0):G(a).drawImage(t,0,0,o,i),a}function tr(t){var e=U.getEnv(),r=e.Image,n=e.Canvas,o=e.Video;return t instanceof r||t instanceof n||t instanceof o}var tn=function(){function t(t,e){var r=this;if(void 0===e&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(t,e){if(g(t,3)){r._imageTensors[e]=t,r._inputDimensions[e]=t.shape;return}if(y(t)){var n=t.shape[0];if(1!==n)throw Error("NetInput - tf.Tensor4D with batchSize "+n+" passed, but not supported in input array");r._imageTensors[e]=t,r._inputDimensions[e]=t.shape.slice(1);return}var o=t instanceof U.getEnv().Canvas?t:te(t);r._canvases[e]=o,r._inputDimensions[e]=[o.height,o.width,3]})}return Object.defineProperty(t.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reshapedInputDimensions",{get:function(){var t=this;return x(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),t.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},t.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},t.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},t.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},t.prototype.getReshapedInputDimensions=function(t){var e,r,n,o,i;if("number"!=typeof this.inputSize)throw Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return e={width:this.getInputWidth(t),height:this.getInputHeight(t)},r=this.inputSize,n=e.width,i=r/Math.max(o=e.height,n),new m(Math.round(n*i),Math.round(o*i))},t.prototype.toBatchTensor=function(t,e){var r=this;return void 0===e&&(e=!0),this._inputSize=t,c.DZQ(function(){var n=x(r.batchSize,0,1).map(function(n){var o=r.getInput(n);if(o instanceof c.qYS){var i,a,s=y(o)?o:o.expandDims();return i=s,void 0===(a=e)&&(a=!1),((s=c.DZQ(function(){var t=i.shape.slice(1),e=t[0],r=t[1];if(e===r)return i;var n=Math.abs(e-r),o=e>r?2:1,s=function(t){var e=i.shape.slice();return e[o]=t,c.GSj(e,0)},u=s(Math.round(n*(a?.5:1))),f=n-u.shape[o],h=[a&&f?s(f):null,i,u].filter(function(t){return!!t}).map(function(t){return t.toFloat()});return c.xWs(h,o)})).shape[1]!==t||s.shape[2]!==t)&&(s=c.Slp.resizeBilinear(s,[t,t])),s.as3D(t,t,3)}if(o instanceof U.getEnv().Canvas)return c.TaL.fromPixels(function(t,e,r){void 0===r&&(r=!1);var n=U.getEnv(),o=n.Image,i=n.Canvas;if(!(t instanceof o||t instanceof i))throw Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=J(t),s=e/Math.max(a.height,a.width),c=s*a.width,u=s*a.height,f=tt({width:e,height:e}),h=t instanceof i?t:te(t),p=Math.abs(c-u)/2,l=r&&c<u?p:0,d=r&&u<c?p:0;return G(f).drawImage(h,l,d,c,u),f}(o,t,e));throw Error("toBatchTensor - at batchIdx "+n+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+o)});return c.t$z(n.map(function(t){return t.toFloat()})).as4D(r.batchSize,t,t,3)})},t}();function to(t){return l(this,void 0,void 0,function(){var e,r,n;return d(this,function(o){switch(o.label){case 0:if(t instanceof tn)return[2,t];if(!(e=Array.isArray(t)?t:[t]).length)throw Error("toNetInput - empty array passed as input");return r=function(e){return Array.isArray(t)?" at input index "+e+":":""},(n=e.map(q)).forEach(function(t,n){if(!tr(t)&&!g(t,3)&&!y(t)){if("string"==typeof e[n])throw Error("toNetInput -"+r(n)+" string passed, but could not resolve HTMLElement for element id "+e[n]);throw Error("toNetInput -"+r(n)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(y(t)){var o=t.shape[0];if(1!==o)throw Error("toNetInput -"+r(n)+" tf.Tensor4D with batchSize "+o+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(t){return tr(t)&&new Promise(function(e,r){if(t instanceof U.getEnv().Canvas||Y(t))return e();function n(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",n),t.currentTarget.removeEventListener("error",o),e(t))}function o(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",n),t.currentTarget.removeEventListener("error",o),r(t))}t.addEventListener("load",n),t.addEventListener("error",o)})}))];case 1:return o.sent(),[2,new tn(n,Array.isArray(t))]}})})}function ti(t,e){return l(this,void 0,void 0,function(){var r,n,o,i,a,s;return d(this,function(u){switch(u.label){case 0:if(r=U.getEnv().Canvas,n=t,t instanceof r)return[3,5];return[4,to(t)];case 1:if((o=u.sent()).batchSize>1)throw Error("extractFaces - batchSize > 1 not supported");if(!((i=o.getInput(0))instanceof r))return[3,2];return a=i,[3,4];case 2:return[4,function(t,e){return l(this,void 0,void 0,function(){var e,r,n,o,i,a;return d(this,function(s){switch(s.label){case 0:return e=U.getEnv().createCanvasElement(),n=(r=t.shape.slice(+!!y(t)))[0],o=r[1],i=r[2],a=c.DZQ(function(){return t.as3D(n,o,i).toInt()}),[4,c.TaL.toPixels(a,e)];case 1:return s.sent(),a.dispose(),[2,e]}})})}(i)];case 3:a=u.sent(),u.label=4;case 4:n=a,u.label=5;case 5:return s=G(n),[2,e.map(function(t){return t instanceof A?t.forSize(n.width,n.height).box.floor():t}).map(function(t){return t.clipAtImageBorders(n.width,n.height)}).map(function(t){var e=t.x,r=t.y,n=t.width,o=t.height,i=tt({width:n,height:o});return G(i).putImageData(s.getImageData(e,r,n,o),0,0),i})]}})})}function ta(t,e){return l(this,void 0,void 0,function(){return d(this,function(r){if(!g(t,3)&&!y(t))throw Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(y(t)&&t.shape[0]>1)throw Error("extractFaceTensors - batchSize > 1 not supported");return[2,c.DZQ(function(){var r=t.shape.slice(+!!y(t)),n=r[0],o=r[1],i=r[2];return e.map(function(t){return t instanceof A?t.forSize(o,n).box:t}).map(function(t){return t.clipAtImageBorders(o,n)}).map(function(e){var r=e.x,a=e.y,s=e.width,u=e.height;return c.wck(t.as3D(n,o,i),[a,r,0],[u,s,i])})})]})})}function ts(t,e){var r=e+"-weights_manifest.json";if(!t)return{modelBaseUri:"",manifestUri:r};if("/"===t)return{modelBaseUri:"/",manifestUri:"/"+r};var n=t.startsWith("http://")?"http://":t.startsWith("https://")?"https://":"",o=(t=t.replace(n,"")).split("/").filter(function(t){return t}),i=t.endsWith(".json")?o[o.length-1]:r,a=n+(t.endsWith(".json")?o.slice(0,o.length-1):o).join("/");return{modelBaseUri:a=t.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+i:a+"/"+i}}function tc(t,e,r){void 0===r&&(r=!1);var n=r?J(e):e,o=n.width,i=n.height;return t.width=o,t.height=i,{width:o,height:i}}var tu=function(){function t(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(t.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),t.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t);return e.obj[e.objProp]},t.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),n=r.obj,o=r.objProp;n[o].dispose(),n[o]=e},t.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},t.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof c.rTt})},t.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof c.rTt)})},t.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var r=e.path,n=e.tensor;t.reassignParamFromPath(r,n.variable())})},t.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,n=e.tensor,o=c.OEK(n.dataSync());n.dispose(),t.reassignParamFromPath(r,o)})},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},t.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){return Array.from(t.tensor.dataSync())}).reduce(function(t,e){return t.concat(e)}))},t.prototype.load=function(t){return l(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:if(t instanceof Float32Array)return this.extractWeights(t),[2];return[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},t.prototype.loadFromUri=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:if(t&&"string"!=typeof t)throw Error(this._name+".loadFromUri - expected model uri");return[4,function(t,e){return l(this,void 0,void 0,function(){var r,n,o,i;return d(this,function(a){switch(a.label){case 0:return n=(r=ts(t,e)).manifestUri,o=r.modelBaseUri,[4,function(t){return l(this,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,function(t,e){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return[4,(0,U.getEnv().fetch)(t,void 0)];case 1:if(!((e=r.sent()).status<400))throw Error("failed to fetch: ("+e.status+") "+e.statusText+", from url: "+e.url);return[2,e]}})})}(t)];case 1:return[2,e.sent().json()]}})})}(n)];case 1:return i=a.sent(),[2,c.io.loadWeights(i,o)]}})})}(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},t.prototype.loadFromDisk=function(t){return l(this,void 0,void 0,function(){var e,r,n,o,i,a,s,u,f,h;return d(this,function(p){switch(p.label){case 0:if(t&&"string"!=typeof t)throw Error(this._name+".loadFromDisk - expected model file path");return e=U.getEnv().readFile,n=(r=ts(t,this.getDefaultModelName())).manifestUri,o=r.modelBaseUri,i=function(t){return Promise.all(t.map(function(t){return e(t).then(function(t){return t.buffer})}))},a=c.io.weightsLoaderFactory(i),f=(u=JSON).parse,[4,e(n)];case 1:return s=f.apply(u,[p.sent().toString()]),[4,a(s,o)];case 2:return h=p.sent(),this.loadFromWeightMap(h),[2]}})})},t.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),r=e.paramMappings,n=e.params;this._paramMappings=r,this._params=n},t.prototype.extractWeights=function(t){var e=this.extractParams(t),r=e.paramMappings,n=e.params;this._paramMappings=r,this._params=n},t.prototype.traversePropertyPath=function(t){if(!this.params)throw Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(e,r){if(!e.nextObj.hasOwnProperty(r))throw Error("traversePropertyPath - object does not have property "+r+", for path "+t);return{obj:e.nextObj,objProp:r,nextObj:e.nextObj[r]}},{nextObj:this.params}),r=e.obj,n=e.objProp;if(!r||!n||!(r[n]instanceof c.qYS))throw Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:n}},t}();function tf(t,e,r){return c.DZQ(function(){var n=c.wdz(t,e.depthwise_filter,e.pointwise_filter,r,"same");return c.WQq(n,e.bias)})}function th(t,e,r){return void 0===r&&(r=!1),c.DZQ(function(){var n=c.VVh(r?c.WQq(c.Xtf(t,e.conv0.filters,[2,2],"same"),e.conv0.bias):tf(t,e.conv0,[2,2])),o=tf(n,e.conv1,[1,1]),i=tf(c.VVh(c.WQq(n,o)),e.conv2,[1,1]);return c.VVh(c.WQq(n,c.WQq(o,i)))})}function tp(t,e,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),c.DZQ(function(){var o=c.VVh(r?c.WQq(c.Xtf(t,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):tf(t,e.conv0,n?[2,2]:[1,1])),i=tf(o,e.conv1,[1,1]),a=tf(c.VVh(c.WQq(o,i)),e.conv2,[1,1]),s=tf(c.VVh(c.WQq(o,c.WQq(i,a))),e.conv3,[1,1]);return c.VVh(c.WQq(o,c.WQq(i,c.WQq(a,s))))})}function tl(t,e,r,n){return void 0===r&&(r="same"),void 0===n&&(n=!1),c.DZQ(function(){var o=c.WQq(c.Xtf(t,e.filters,[1,1],r),e.bias);return n?c.VVh(o):o})}function td(t,e){Object.keys(t).forEach(function(r){e.some(function(t){return t.originalPath===r})||t[r].dispose()})}function tv(t,e){return function(r,n,o,i){var a=c.g9W(t(r*n*o*o),[o,o,r,n]),s=c.tGX(t(n));return e.push({paramPath:i+"/filters"},{paramPath:i+"/bias"}),{filters:a,bias:s}}}function tm(t,e){return function(r,n,o){var i=c.KtR(t(r*n),[r,n]),a=c.tGX(t(n));return e.push({paramPath:o+"/weights"},{paramPath:o+"/bias"}),{weights:i,bias:a}}}var tg=function(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r};function ty(t,e){return function(r,n,o){var i=c.g9W(t(9*r),[3,3,r,1]),a=c.g9W(t(r*n),[1,1,r,n]),s=c.tGX(t(n));return e.push({paramPath:o+"/depthwise_filter"},{paramPath:o+"/pointwise_filter"},{paramPath:o+"/bias"}),new tg(i,a,s)}}function tb(t){return function(e){return new tg(t(e+"/depthwise_filter",4),t(e+"/pointwise_filter",4),t(e+"/bias",1))}}function t_(t,e){return function(r,n,o){var i=t[r];if(!g(i,n))throw Error("expected weightMap["+r+"] to be a Tensor"+n+"D, instead have "+i);return e.push({originalPath:r,paramPath:o||r}),i}}function tw(t){var e=t;return{extractWeights:function(t){var r=e.slice(0,t);return e=e.slice(t),r},getRemainingWeights:function(){return e}}}function tx(t,e){var r=tv(t,e),n=ty(t,e);function o(t,e,o,i){return void 0===i&&(i=!1),{conv0:i?r(t,e,3,o+"/conv0"):n(t,e,o+"/conv0"),conv1:n(e,e,o+"/conv1"),conv2:n(e,e,o+"/conv2")}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:function(t,e,r,i){void 0===i&&(i=!1);var a=o(t,e,r,i);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:n(e,e,r+"/conv3")}}}}function tE(t){return function(e){return{filters:t(e+"/filters",4),bias:t(e+"/bias",1)}}}function tP(t,e){var r=t_(t,e),n=tE(r),o=tb(r);return{extractDenseBlock3Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?n(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2")}},extractDenseBlock4Params:function(t,e){return void 0===e&&(e=!1),{conv0:e?n(t+"/conv0"):o(t+"/conv0"),conv1:o(t+"/conv1"),conv2:o(t+"/conv2"),conv3:o(t+"/conv3")}}}}var tM=function(t){function e(){return t.call(this,"FaceFeatureExtractor")||this}return h(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("FaceFeatureExtractor - load model before inference");return c.DZQ(function(){var r=tp(O(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(c.d_2(255)),e.dense0,!0);return r=tp(r,e.dense1),r=tp(r,e.dense2),r=tp(r,e.dense3),r=c.$jT(r,[7,7],[2,2],"valid")})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n;return n={dense0:(r=tP(t,e=[]).extractDenseBlock4Params)("dense0",!0),dense1:r("dense1"),dense2:r("dense2"),dense3:r("dense3")},td(t,e),{params:n,paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=[],r=tw(t),n=r.extractWeights,o=r.getRemainingWeights,i=tx(n,e).extractDenseBlock4Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:c,dense3:u}}}(t)},e}(tu);function tD(t,e){return c.DZQ(function(){return c.WQq(c.NoW(t,e.weights),e.bias)})}function tS(t){var e={},r={};return Object.keys(t).forEach(function(n){(n.startsWith("fc")?r:e)[n]=t[n]}),{featureExtractorMap:e,classifierMap:r}}var tT=function(t){function e(e,r){var n=t.call(this,e)||this;return n._faceFeatureExtractor=r,n}return h(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,r=this.params;if(!r)throw Error(this._name+" - load model before inference");return c.DZQ(function(){var n=t instanceof tn?e.faceFeatureExtractor.forwardInput(t):t;return tD(n.as2D(n.shape[0],-1),r.fc)})},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),r=e.params,n=e.paramMappings;this._params=r,this._paramMappings=n},e.prototype.extractClassifierParams=function(t){return function(t,e,r){var n=[],o=tw(t),i=o.extractWeights,a=o.getRemainingWeights,s=tm(i,n)(e,r,"fc");if(0!==a().length)throw Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:s}}}(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n,o=tS(t),i=o.featureExtractorMap,a=o.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),n={fc:{weights:(r=t_(a,e=[]))("fc/weights",2),bias:r("fc/bias",1)}},td(a,e),{params:n,paramMappings:e}},e.prototype.extractParams=function(t){var e=this.getClassifierChannelsIn(),r=this.getClassifierChannelsOut(),n=r*e+r,o=t.slice(0,t.length-n),i=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(o),this.extractClassifierParams(i)},e}(tu),tA=["neutral","happy","sad","angry","fearful","disgusted","surprised"],tF=function(){function t(t){var e=this;if(7!==t.length)throw Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);tA.forEach(function(r,n){e[r]=t[n]})}return t.prototype.asSortedArray=function(){var t=this;return tA.map(function(e){return{expression:e,probability:t[e]}}).sort(function(t,e){return e.probability-t.probability})},t}(),tO=function(t){function e(e){return void 0===e&&(e=new tM),t.call(this,"FaceExpressionNet",e)||this}return h(e,t),e.prototype.forwardInput=function(t){var e=this;return c.DZQ(function(){return c.Vs9(e.runNet(t))})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.predictExpressions=function(t){return l(this,void 0,void 0,function(){var e,r,n,o,i=this;return d(this,function(a){switch(a.label){case 0:return[4,to(t)];case 1:return e=a.sent(),[4,this.forwardInput(e)];case 2:return r=a.sent(),[4,Promise.all(c.K$i(r).map(function(t){return l(i,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return[4,t.data()];case 1:return e=r.sent(),t.dispose(),[2,e]}})})}))];case 3:return n=a.sent(),r.dispose(),o=n.map(function(t){return new tF(t)}),[2,e.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e}(tT);function tB(t,e){return Object.assign({},t,{expressions:e})}function tC(t,e,r,n){void 0===r&&(r=.1),(Array.isArray(e)?e:[e]).forEach(function(e){var o=e instanceof tF?e:e.expressions instanceof tF?e.expressions:void 0;if(!o)throw Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=o.asSortedArray().filter(function(t){return t.probability>r}),a=R(e)?e.detection.box.bottomLeft:n||new M(0,0);new H(i.map(function(t){return t.expression+" ("+b(t.probability)+")"}),a).draw(t)})}function tk(t){return R(t)&&t.landmarks instanceof k&&t.unshiftedLandmarks instanceof k&&t.alignedRect instanceof A}function tI(t,e){var r=t.detection.box,n=e.shiftBy(r.x,r.y),o=n.align(),i=t.detection.imageDims,a=new A(t.detection.score,o.rescale(i.reverse()),i);return Object.assign({},t,{landmarks:n,unshiftedLandmarks:e,alignedRect:a})}var tj=function(t){void 0===t&&(t={});var e=t.drawLines,r=t.drawPoints,n=t.lineWidth,o=t.lineColor,i=t.pointSize,a=t.pointColor;this.drawLines=void 0===e||e,this.drawPoints=void 0===r||r,this.lineWidth=n||1,this.pointSize=i||2,this.lineColor=o||"rgba(0, 255, 255, 1)",this.pointColor=a||"rgba(255, 0, 255, 1)"},tL=function(){function t(t,e){void 0===e&&(e={}),this.faceLandmarks=t,this.options=new tj(e)}return t.prototype.draw=function(t){var e=G(t),r=this.options,n=r.drawLines,o=r.drawPoints,i=r.lineWidth,a=r.lineColor,s=r.pointSize,c=r.pointColor;n&&this.faceLandmarks instanceof j&&(e.strokeStyle=a,e.lineWidth=i,u(e,this.faceLandmarks.getJawOutline()),u(e,this.faceLandmarks.getLeftEyeBrow()),u(e,this.faceLandmarks.getRightEyeBrow()),u(e,this.faceLandmarks.getNose()),u(e,this.faceLandmarks.getLeftEye(),!0),u(e,this.faceLandmarks.getRightEye(),!0),u(e,this.faceLandmarks.getMouth(),!0)),o&&(e.strokeStyle=c,e.fillStyle=c,this.faceLandmarks.positions.forEach(function(t){e.beginPath(),e.arc(t.x,t.y,s,0,2*Math.PI),e.fill()}))},t}();function tW(t,e){(Array.isArray(e)?e:[e]).forEach(function(e){var r=e instanceof k?e:tk(e)?e.landmarks:void 0;if(!r)throw Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new tL(r).draw(t)})}function tN(t,e,r){return c.WQq(c.Xtf(t,e.filters,r,"same"),e.bias)}function tR(t,e,r){void 0===r&&(r=!0);var n=r?c.VVh(t):t;return n=tf(n,e.separable_conv0,[1,1]),n=tf(c.VVh(n),e.separable_conv1,[1,1]),n=c.jgi(n,[3,3],[2,2],"same"),n=c.WQq(n,tN(t,e.expansion_conv,[2,2]))}var tz=function(t){function e(e){var r=t.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return h(e,t),e.prototype.forwardInput=function(t){var e=this,r=this.params;if(!r)throw Error("TinyXception - load model before inference");return c.DZQ(function(){var n=O(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(c.d_2(256)),o=c.VVh(tN(n,r.entry_flow.conv_in,[2,2]));return o=tR(o,r.entry_flow.reduction_block_0,!1),o=tR(o,r.entry_flow.reduction_block_1),x(e._numMainBlocks,0,1).forEach(function(t){var e,n,i;e=o,n=r.middle_flow["main_block_"+t],i=tf(c.VVh(e),n.separable_conv0,[1,1]),i=tf(c.VVh(i),n.separable_conv1,[1,1]),i=tf(c.VVh(i),n.separable_conv2,[1,1]),o=i=c.WQq(i,e)}),o=tR(o,r.exit_flow.reduction_block),o=c.VVh(tf(o,r.exit_flow.separable_conv,[1,1]))})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n,o,i,a,s,c,u,f,h,p,l,d,v,m,g;return e=t,r=this._numMainBlocks,c=(s={extractConvParams:o=tE(n=t_(e,a=[])),extractSeparableConvParams:i=tb(n),extractReductionBlockParams:function(t){return{separable_conv0:i(t+"/separable_conv0"),separable_conv1:i(t+"/separable_conv1"),expansion_conv:o(t+"/expansion_conv")}},extractMainBlockParams:function(t){return{separable_conv0:i(t+"/separable_conv0"),separable_conv1:i(t+"/separable_conv1"),separable_conv2:i(t+"/separable_conv2")}}}).extractConvParams,u=s.extractSeparableConvParams,f=s.extractReductionBlockParams,h=s.extractMainBlockParams,p=c("entry_flow/conv_in"),l=f("entry_flow/reduction_block_0"),d=f("entry_flow/reduction_block_1"),v={},x(r,0,1).forEach(function(t){v["main_block_"+t]=h("middle_flow/main_block_"+t)}),m=f("exit_flow/reduction_block"),g=u("exit_flow/separable_conv"),td(e,a),{params:{entry_flow:{conv_in:p,reduction_block_0:l,reduction_block_1:d},middle_flow:v,exit_flow:{reduction_block:m,separable_conv:g}},paramMappings:a}},e.prototype.extractParams=function(t){return function(t,e){var r,n,o=[],i=tw(t),a=i.extractWeights,s=i.getRemainingWeights,c={extractConvParams:r=tv(a,o),extractSeparableConvParams:n=ty(a,o),extractReductionBlockParams:function(t,e,o){return{separable_conv0:n(t,e,o+"/separable_conv0"),separable_conv1:n(e,e,o+"/separable_conv1"),expansion_conv:r(t,e,1,o+"/expansion_conv")}},extractMainBlockParams:function(t,e){return{separable_conv0:n(t,t,e+"/separable_conv0"),separable_conv1:n(t,t,e+"/separable_conv1"),separable_conv2:n(t,t,e+"/separable_conv2")}}},u=c.extractConvParams,f=c.extractSeparableConvParams,h=c.extractReductionBlockParams,p=c.extractMainBlockParams,l=u(3,32,3,"entry_flow/conv_in"),d=h(32,64,"entry_flow/reduction_block_0"),v=h(64,128,"entry_flow/reduction_block_1"),m={};x(e,0,1).forEach(function(t){m["main_block_"+t]=p(128,"middle_flow/main_block_"+t)});var g=h(128,256,"exit_flow/reduction_block"),y=f(256,512,"exit_flow/separable_conv");if(0!==s().length)throw Error("weights remaing after extract: "+s().length);return{paramMappings:o,params:{entry_flow:{conv_in:l,reduction_block_0:d,reduction_block_1:v},middle_flow:m,exit_flow:{reduction_block:g,separable_conv:y}}}}(t,this._numMainBlocks)},e}(tu);!function(t){t.FEMALE="female",t.MALE="male"}(i||(i={}));var tQ=function(t){function e(e){void 0===e&&(e=new tz(2));var r=t.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return h(e,t),Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var e=this,r=this.params;if(!r)throw Error(this._name+" - load model before inference");return c.DZQ(function(){var n=t instanceof tn?e.faceFeatureExtractor.forwardInput(t):t,o=c.$jT(n,[7,7],[2,2],"valid").as2D(n.shape[0],-1);return{age:tD(o,r.fc.age).as1D(),gender:tD(o,r.fc.gender)}})},e.prototype.forwardInput=function(t){var e=this;return c.DZQ(function(){var r=e.runNet(t),n=r.age,o=r.gender;return{age:n,gender:c.Vs9(o)}})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return l(this,void 0,void 0,function(){var e,r,n,o,a,s=this;return d(this,function(u){switch(u.label){case 0:return[4,to(t)];case 1:return e=u.sent(),[4,this.forwardInput(e)];case 2:return r=u.sent(),n=c.K$i(r.age),o=c.K$i(r.gender),[4,Promise.all(n.map(function(t,e){return{ageTensor:t,genderTensor:o[e]}}).map(function(t){var e=t.ageTensor,r=t.genderTensor;return l(s,void 0,void 0,function(){var t,n,o,a,s;return d(this,function(c){switch(c.label){case 0:return[4,e.data()];case 1:return t=c.sent()[0],[4,r.data()];case 2:return a=(o=(n=c.sent()[0])>.5)?i.MALE:i.FEMALE,s=o?n:1-n,e.dispose(),r.dispose(),[2,{age:t,gender:a,genderProbability:s}]}})})}))];case 3:return a=u.sent(),r.age.dispose(),r.gender.dispose(),[2,e.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.faceFeatureExtractor.dispose(e),t.prototype.dispose.call(this,e)},e.prototype.loadClassifierParams=function(t){var e=this.extractClassifierParams(t),r=e.params,n=e.paramMappings;this._params=r,this._paramMappings=n},e.prototype.extractClassifierParams=function(t){return function(t){var e=[],r=tw(t),n=r.extractWeights,o=r.getRemainingWeights,i=tm(n,e),a=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}(t)},e.prototype.extractParamsFromWeigthMap=function(t){var e=tS(t),r=e.featureExtractorMap,n=e.classifierMap;this.faceFeatureExtractor.loadFromWeightMap(r);var o=[],i=t_(n,o);function a(t){return{weights:i(t+"/weights",2),bias:i(t+"/bias",1)}}var s={fc:{age:a("fc/age"),gender:a("fc/gender")}};return td(n,o),{params:s,paramMappings:o}},e.prototype.extractParams=function(t){var e=t.slice(0,t.length-1539),r=t.slice(t.length-1539);return this.faceFeatureExtractor.extractWeights(e),this.extractClassifierParams(r)},e}(tu),tV=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.postProcess=function(t,e,r){var n=r.map(function(t){var r=t.width,n=t.height,o=e/Math.max(n,r);return{width:r*o,height:n*o}}),o=n.length;return c.DZQ(function(){var r=function(t,e){return c.t$z([c.GSj([68],t),c.GSj([68],e)],1).as2D(1,136).as1D()},i=function(t,e){var r=n[t],o=r.width,i=r.height;return e(o,i)?Math.abs(o-i)/2:0};return t.mul(c.GSj([o,136],e)).sub(c.t$z(Array.from(Array(o),function(t,e){return r(i(e,function(t,e){return t<e}),i(e,function(t,e){return e<t}))}))).div(c.t$z(Array.from(Array(o),function(t,e){return r(n[e].width,n[e].height)})))})},e.prototype.forwardInput=function(t){var e=this;return c.DZQ(function(){var r=e.runNet(t);return e.postProcess(r,t.inputSize,t.inputDimensions.map(function(t){return{height:t[0],width:t[1]}}))})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.detectLandmarks=function(t){return l(this,void 0,void 0,function(){var e,r,n,o=this;return d(this,function(i){switch(i.label){case 0:return[4,to(t)];case 1:return e=i.sent(),[4,Promise.all((r=c.DZQ(function(){return c.K$i(o.forwardInput(e))})).map(function(t,r){return l(o,void 0,void 0,function(){var n,o,i,a,s;return d(this,function(c){switch(c.label){case 0:return i=(o=Array).from,[4,t.data()];case 1:return a=(n=i.apply(o,[c.sent()])).filter(function(t,e){return e%2==0}),s=n.filter(function(t,e){return e%2!=0}),[2,new j(Array(68).fill(0).map(function(t,e){return new M(a[e],s[e])}),{height:e.getInputHeight(r),width:e.getInputWidth(r)})]}})})}))];case 2:return n=i.sent(),r.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?n:n[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e}(tT),tU=function(t){function e(e){return void 0===e&&(e=new tM),t.call(this,"FaceLandmark68Net",e)||this}return h(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e}(tV),tq=function(t){function e(){return t.call(this,"TinyFaceFeatureExtractor")||this}return h(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("TinyFaceFeatureExtractor - load model before inference");return c.DZQ(function(){var r=th(O(t.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(c.d_2(255)),e.dense0,!0);return r=th(r,e.dense1),r=th(r,e.dense2),r=c.$jT(r,[14,14],[2,2],"valid")})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n;return n={dense0:(r=tP(t,e=[]).extractDenseBlock3Params)("dense0",!0),dense1:r("dense1"),dense2:r("dense2")},td(t,e),{params:n,paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=[],r=tw(t),n=r.extractWeights,o=r.getRemainingWeights,i=tx(n,e).extractDenseBlock3Params,a=i(3,32,"dense0",!0),s=i(32,64,"dense1"),c=i(64,128,"dense2");if(0!==o().length)throw Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:c}}}(t)},e}(tu),tG=function(t){function e(e){return void 0===e&&(e=new tq),t.call(this,"FaceLandmark68TinyNet",e)||this}return h(e,t),e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e}(tV);function tZ(t,e,r,n,o){void 0===o&&(o="same");var i,a,s=e.conv,u=s.filters,f=s.bias,h=c.Xtf(t,u,r,o);return i=h=c.WQq(h,f),a=e.scale,h=c.WQq(c.lKK(i,a.weights),a.biases),n?c.VVh(h):h}function tH(t,e){return tZ(t,e,[1,1],!1)}function tK(t,e){return tZ(t,e,[2,2],!0,"valid")}function t$(t,e){var r=tZ(t,e.conv1,[1,1],!0);return r=tH(r,e.conv2),r=c.WQq(r,t),r=c.VVh(r)}function tX(t,e){var r=tK(t,e.conv1);r=tH(r,e.conv2);var n=c.$jT(t,2,2,"valid"),o=c.Ul9(n.shape),i=n.shape[3]!==r.shape[3];if(n.shape[1]!==r.shape[1]||n.shape[2]!==r.shape[2]){var a=v(r.shape);a[1]=1;var s=c.Ul9(a),u=v((r=c.xWs([r,s],1)).shape);u[2]=1;var f=c.Ul9(u);r=c.xWs([r,f],2)}return n=i?c.xWs([n,o],3):n,r=c.WQq(n,r),r=c.VVh(r)}!function(t){h(function(){return null!==t&&t.apply(this,arguments)||this},t)}(tU);var tY=function(t){function e(){return t.call(this,"FaceRecognitionNet")||this}return h(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("FaceRecognitionNet - load model before inference");return c.DZQ(function(){var r=tK(O(t.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(c.d_2(256)),e.conv32_down);r=t$(r=c.jgi(r,3,2,"valid"),e.conv32_1),r=t$(r,e.conv32_2),r=tX(r=t$(r,e.conv32_3),e.conv64_down),r=t$(r,e.conv64_1),r=t$(r,e.conv64_2),r=tX(r=t$(r,e.conv64_3),e.conv128_down),r=t$(r,e.conv128_1),r=tX(r=t$(r,e.conv128_2),e.conv256_down),r=t$(r,e.conv256_1);var n=(r=tX(r=t$(r,e.conv256_2),e.conv256_down_out)).mean([1,2]);return c.NoW(n,e.fc)})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return l(this,void 0,void 0,function(){var e,r,n,o=this;return d(this,function(i){switch(i.label){case 0:return[4,to(t)];case 1:return e=i.sent(),[4,Promise.all((r=c.DZQ(function(){return c.K$i(o.forwardInput(e))})).map(function(t){return t.data()}))];case 2:return n=i.sent(),r.forEach(function(t){return t.dispose()}),[2,e.isBatchInput?n:n[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],r=function(t,e){var r=t_(t,e);function n(t){return{conv:{filters:r(t+"/conv/filters",4),bias:r(t+"/conv/bias",1)},scale:{weights:r(t+"/scale/weights",1),biases:r(t+"/scale/biases",1)}}}return{extractConvLayerParams:n,extractResidualLayerParams:function(t){return{conv1:n(t+"/conv1"),conv2:n(t+"/conv2")}}}}(t,e),n=r.extractConvLayerParams,o=r.extractResidualLayerParams,i=n("conv32_down"),a=o("conv32_1"),s=o("conv32_2"),c=o("conv32_3"),u=o("conv64_down"),f=o("conv64_1"),h=o("conv64_2"),p=o("conv64_3"),l=o("conv128_down"),d=o("conv128_1"),v=o("conv128_2"),m=o("conv256_down"),y=o("conv256_1"),b=o("conv256_2"),_=o("conv256_down_out"),w=t.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!g(w,2))throw Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);return td(t,e),{params:{conv32_down:i,conv32_1:a,conv32_2:s,conv32_3:c,conv64_down:u,conv64_1:f,conv64_2:h,conv64_3:p,conv128_down:l,conv128_1:d,conv128_2:v,conv256_down:m,conv256_1:y,conv256_2:b,conv256_down_out:_,fc:w},paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=tw(t),r=e.extractWeights,n=e.getRemainingWeights,o=[],i=function(t,e){function r(r,n,o,i){var a,s,u,f,h,p;return{conv:(a=i+"/conv",s=function(e,r,n){var o=t(e),i=o.length/(r*n*n);if(i%1!=0)throw Error("depth has to be an integer: "+i+", weights.length: "+o.length+", numFilters: "+r+", filterSize: "+n);return c.DZQ(function(){return c.mgz(c.g9W(o,[r,i,n,n]),[2,3,1,0])})}(r,n,o),u=c.tGX(t(n)),e.push({paramPath:a+"/filters"},{paramPath:a+"/bias"}),{filters:s,bias:u}),scale:(f=i+"/scale",h=c.tGX(t(n)),p=c.tGX(t(n)),e.push({paramPath:f+"/weights"},{paramPath:f+"/biases"}),{weights:h,biases:p})}}return{extractConvLayerParams:r,extractResidualLayerParams:function(t,e,n,o,i){return void 0===i&&(i=!1),{conv1:r((i?.5:1)*t,e,n,o+"/conv1"),conv2:r(t,e,n,o+"/conv2")}}}}(r,o),a=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),f=s(9216,32,3,"conv32_1"),h=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),l=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),v=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),b=s(147456,128,3,"conv128_2"),_=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),x=s(589824,256,3,"conv256_2"),E=s(589824,256,3,"conv256_down_out"),P=c.DZQ(function(){return c.mgz(c.KtR(r(32768),[128,256]),[1,0])});if(o.push({paramPath:"fc"}),0!==n().length)throw Error("weights remaing after extract: "+n().length);return{params:{conv32_down:u,conv32_1:f,conv32_2:h,conv32_3:p,conv64_down:l,conv64_1:d,conv64_2:v,conv64_3:m,conv128_down:g,conv128_1:y,conv128_2:b,conv256_down:_,conv256_1:w,conv256_2:x,conv256_down_out:E,fc:P},paramMappings:o}}(t)},e}(tu);function tJ(t,e,r){return Object.assign({},t,{gender:e,genderProbability:r})}var t0=function(){function t(t){var e=void 0===t?{}:t,r=e.minFaceSize,n=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,a=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=n||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some(function(t){return"number"!=typeof t}))throw Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(t){return"number"!=typeof t})))throw Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(t.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),t}();function t1(t,e,r){return c.DZQ(function(){var n=c.Xtf(t,e.filters,r,"same");return n=c.WQq(n,e.batch_norm_offset),c.zQh(n,0,6)})}function t2(t,e){return c.DZQ(function(){var r=t.shape[0];return{boxPredictionEncoding:c.tQQ(tl(t,e.box_encoding_predictor),[r,-1,1,4]),classPrediction:c.tQQ(tl(t,e.class_predictor),[r,-1,3])}})}var t4=function(){function t(t){var e=void 0===t?{}:t,r=e.minConfidence,n=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=n||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(t.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),t}(),t3=function(t){function e(){return t.call(this,"SsdMobilenetv1")||this}return h(e,t),e.prototype.forwardInput=function(t){var e=this.params;if(!e)throw Error("SsdMobilenetv1 - load model before inference");return c.DZQ(function(){var r,n,o,i,a,s,u=t.toBatchTensor(512,!1).toFloat(),f=(r=c.jbE(c.lKK(u,c.d_2(.007843137718737125)),c.d_2(1)),n=e.mobilenetv1,c.DZQ(function(){var t=null,e=t1(r,n.conv_0,[2,2]);if([n.conv_1,n.conv_2,n.conv_3,n.conv_4,n.conv_5,n.conv_6,n.conv_7,n.conv_8,n.conv_9,n.conv_10,n.conv_11,n.conv_12,n.conv_13].forEach(function(r,n){var o,i,a=n+1,s=[2,4,6,12].some(function(t){return t===a})?[2,2]:[1,1];o=e,i=r.depthwise_conv,e=t1(e=c.DZQ(function(){var t=c.Gl3(o,i.filters,s,"same");return t=c.$v7(t,i.batch_norm_mean,i.batch_norm_variance,i.batch_norm_offset,i.batch_norm_scale,.0010000000474974513),c.zQh(t,0,6)}),r.pointwise_conv,[1,1]),11===a&&(t=e)}),null===t)throw Error("mobileNetV1 - output of conv layer 11 is null");return{out:e,conv11:t}})),h=(o=f.out,i=f.conv11,a=e.prediction_layer,c.DZQ(function(){var t=t1(o,a.conv_0,[1,1]),e=t1(t,a.conv_1,[2,2]),r=t1(e,a.conv_2,[1,1]),n=t1(r,a.conv_3,[2,2]),s=t1(n,a.conv_4,[1,1]),u=t1(s,a.conv_5,[2,2]),f=t1(u,a.conv_6,[1,1]),h=t1(f,a.conv_7,[2,2]),p=t2(i,a.box_predictor_0),l=t2(o,a.box_predictor_1),d=t2(e,a.box_predictor_2),v=t2(n,a.box_predictor_3),m=t2(u,a.box_predictor_4),g=t2(h,a.box_predictor_5);return{boxPredictions:c.xWs([p.boxPredictionEncoding,l.boxPredictionEncoding,d.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding],1),classPredictions:c.xWs([p.classPrediction,l.classPrediction,d.classPrediction,v.classPrediction,m.classPrediction,g.classPrediction],1)}})),p=h.boxPredictions,l=h.classPredictions;return s=e.output_layer,c.DZQ(function(){var t,e,r,n,o,i,a,u,f,h,d,v,m,g=p.shape[0],y=(t=c.tQQ(c.Vsq(s.extra_dim,[g,1,1]),[-1,4]),e=c.tQQ(p,[-1,4]),a=(r=c.K$i(c.mgz(t,[1,0])),n=[c.jbE(r[2],r[0]),c.jbE(r[3],r[1])],o=[c.WQq(r[0],c.y4m(n[0],c.d_2(2))),c.WQq(r[1],c.y4m(n[1],c.d_2(2)))],i={sizes:n,centers:o}).sizes,u=i.centers,f=c.K$i(c.mgz(e,[1,0])),h=c.y4m(c.lKK(c.oNF(c.y4m(f[2],c.d_2(5))),a[0]),c.d_2(2)),d=c.WQq(c.lKK(c.y4m(f[0],c.d_2(10)),a[0]),u[0]),v=c.y4m(c.lKK(c.oNF(c.y4m(f[3],c.d_2(5))),a[1]),c.d_2(2)),m=c.WQq(c.lKK(c.y4m(f[1],c.d_2(10)),a[1]),u[1]),c.mgz(c.t$z([c.jbE(d,h),c.jbE(m,v),c.WQq(d,h),c.WQq(m,v)]),[1,0]));y=c.tQQ(y,[g,y.shape[0]/g,4]);var b=c.ry7(c.dik(l,[0,0,1],[-1,-1,-1])),_=c.dik(b,[0,0,0],[-1,-1,1]);return _=c.tQQ(_,[g,_.shape[1]]),{boxes:c.K$i(y),scores:c.K$i(_)}})})},e.prototype.forward=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=this.forwardInput,[4,to(t)];case 1:return[2,e.apply(this,[r.sent()])]}})})},e.prototype.locateFaces=function(t,e){return void 0===e&&(e={}),l(this,void 0,void 0,function(){var r,n,o,i,a,s,c,u,f,h,p,l,v,m,g,y,b,_,w,x;return d(this,function(d){switch(d.label){case 0:return n=(r=new t4(e)).maxResults,o=r.minConfidence,[4,to(t)];case 1:for(i=d.sent(),s=(a=this.forwardInput(i)).boxes,c=a.scores,u=s[0],f=c[0],h=1;h<s.length;h++)s[h].dispose(),c[h].dispose();return v=(l=Array).from,[4,f.data()];case 2:var E,P,M,D,S,T;return p=v.apply(l,[d.sent()]),E=u,P=n,M=o,D=Math.min(P,E.shape[0]),S=p.map(function(t,e){return{score:t,boxIndex:e}}).filter(function(t){return t.score>M}).sort(function(t,e){return e.score-t.score}),T=[],S.forEach(function(t){if(!(T.length>=D)){for(var e=t.score,r=T.length-1;r>=0;--r){var n=function(t,e,r){var n=t.arraySync(),o=Math.min(n[e][0],n[e][2]),i=Math.min(n[e][1],n[e][3]),a=Math.max(n[e][0],n[e][2]),s=Math.max(n[e][1],n[e][3]),c=Math.min(n[r][0],n[r][2]),u=Math.min(n[r][1],n[r][3]),f=Math.max(n[r][0],n[r][2]),h=Math.max(n[r][1],n[r][3]),p=(a-o)*(s-i),l=(f-c)*(h-u);if(p<=0||l<=0)return 0;var d=Math.max(Math.min(a,f)-Math.max(o,c),0)*Math.max(Math.min(s,h)-Math.max(i,u),0);return d/(p+l-d)}(E,t.boxIndex,T[r]);if(0!==n&&(t.score*=n<=.5,t.score<=M))break}e===t.score&&T.push(t.boxIndex)}}),m=T,g=i.getReshapedInputDimensions(0),b=(y=i.inputSize)/g.width,_=y/g.height,w=u.arraySync(),x=m.map(function(t){var e=[Math.max(0,w[t][0]),Math.min(1,w[t][2])].map(function(t){return t*_}),r=e[0],n=e[1],o=[Math.max(0,w[t][1]),Math.min(1,w[t][3])].map(function(t){return t*b}),a=o[0],s=o[1];return new A(p[t],new C(a,r,s-a,n-r),{height:i.getInputHeight(0),width:i.getInputWidth(0)})}),u.dispose(),f.dispose(),[2,x]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return function(t){var e=[],r=function(t,e){var r=t_(t,e);function n(t,e,n){return{filters:r(t+"/Conv2d_"+e+"_pointwise/weights",4,n+"/filters"),batch_norm_offset:r(t+"/Conv2d_"+e+"_pointwise/convolution_bn_offset",1,n+"/batch_norm_offset")}}function o(t){var e="mobilenetv1/conv_"+t,o="MobilenetV1/Conv2d_"+t+"_depthwise",i=e+"/depthwise_conv";return{depthwise_conv:{filters:r(o+"/depthwise_weights",4,i+"/filters"),batch_norm_scale:r(o+"/BatchNorm/gamma",1,i+"/batch_norm_scale"),batch_norm_offset:r(o+"/BatchNorm/beta",1,i+"/batch_norm_offset"),batch_norm_mean:r(o+"/BatchNorm/moving_mean",1,i+"/batch_norm_mean"),batch_norm_variance:r(o+"/BatchNorm/moving_variance",1,i+"/batch_norm_variance")},pointwise_conv:n("MobilenetV1",t,e+"/pointwise_conv")}}function i(t,e){return{filters:r(t+"/weights",4,e+"/filters"),bias:r(t+"/biases",1,e+"/bias")}}function a(t){return{box_encoding_predictor:i("Prediction/BoxPredictor_"+t+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+t+"/box_encoding_predictor"),class_predictor:i("Prediction/BoxPredictor_"+t+"/ClassPredictor","prediction_layer/box_predictor_"+t+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:o(1),conv_2:o(2),conv_3:o(3),conv_4:o(4),conv_5:o(5),conv_6:o(6),conv_7:o(7),conv_8:o(8),conv_9:o(9),conv_10:o(10),conv_11:o(11),conv_12:o(12),conv_13:o(13)}},extractPredictionLayerParams:function(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(t,e),n=r.extractMobilenetV1Params,o=r.extractPredictionLayerParams,i=t["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!g(i,3))throw Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+i);var a={mobilenetv1:n(),prediction_layer:o(),output_layer:{extra_dim:i}};return td(t,e),{params:a,paramMappings:e}}(t)},e.prototype.extractParams=function(t){return function(t){var e=[],r=tw(t),n=r.extractWeights,o=r.getRemainingWeights,i=function(t,e){function r(r,n,o,i,a){var s=c.g9W(t(r*n*o*o),[o,o,r,n]),u=c.tGX(t(n));return e.push({paramPath:i+"/filters"},{paramPath:i+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function n(t,e,n,o){var i=r(t,e,n,o,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function o(r,o,i){var a,s,u,f,h,p;return{depthwise_conv:(a=i+"/depthwise_conv",s=c.g9W(t(9*r),[3,3,r,1]),u=c.tGX(t(r)),f=c.tGX(t(r)),h=c.tGX(t(r)),p=c.tGX(t(r)),e.push({paramPath:a+"/filters"},{paramPath:a+"/batch_norm_scale"},{paramPath:a+"/batch_norm_offset"},{paramPath:a+"/batch_norm_mean"},{paramPath:a+"/batch_norm_variance"}),{filters:s,batch_norm_scale:u,batch_norm_offset:f,batch_norm_mean:h,batch_norm_variance:p}),pointwise_conv:n(r,o,1,i+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:n(3,32,3,"mobilenetv1/conv_0"),conv_1:o(32,64,"mobilenetv1/conv_1"),conv_2:o(64,128,"mobilenetv1/conv_2"),conv_3:o(128,128,"mobilenetv1/conv_3"),conv_4:o(128,256,"mobilenetv1/conv_4"),conv_5:o(256,256,"mobilenetv1/conv_5"),conv_6:o(256,512,"mobilenetv1/conv_6"),conv_7:o(512,512,"mobilenetv1/conv_7"),conv_8:o(512,512,"mobilenetv1/conv_8"),conv_9:o(512,512,"mobilenetv1/conv_9"),conv_10:o(512,512,"mobilenetv1/conv_10"),conv_11:o(512,512,"mobilenetv1/conv_11"),conv_12:o(512,1024,"mobilenetv1/conv_12"),conv_13:o(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:n(1024,256,1,"prediction_layer/conv_0"),conv_1:n(256,512,3,"prediction_layer/conv_1"),conv_2:n(512,128,1,"prediction_layer/conv_2"),conv_3:n(128,256,3,"prediction_layer/conv_3"),conv_4:n(256,128,1,"prediction_layer/conv_4"),conv_5:n(128,256,3,"prediction_layer/conv_5"),conv_6:n(256,64,1,"prediction_layer/conv_6"),conv_7:n(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:r(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:r(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:r(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:r(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(n,e),a=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=a(),f=s(),h=c.$_$(n(20472),[1,5118,4]);if(e.push({paramPath:"output_layer/extra_dim"}),0!==o().length)throw Error("weights remaing after extract: "+o().length);return{params:{mobilenetv1:u,prediction_layer:f,output_layer:{extra_dim:h}},paramMappings:e}}(t)},e}(tu);!function(t){h(function(){return null!==t&&t.apply(this,arguments)||this},t)}(t3);var t6=[new M(.738768,.874946),new M(2.42204,2.65704),new M(4.30971,7.04493),new M(10.246,4.59428),new M(12.6868,11.8741)],t5=[new M(1.603231,2.094468),new M(6.041143,7.080126),new M(2.882459,3.518061),new M(4.266906,5.178857),new M(9.041765,10.66308)],t8=[117.001,114.697,97.404],t7=function(t){return"number"==typeof t};function t9(t){return c.DZQ(function(){var e=c.lKK(t,c.d_2(.10000000149011612));return c.WQq(c.VVh(c.jbE(t,e)),e)})}function et(t,e){return c.DZQ(function(){var r=c.eVF(t,[[0,0],[1,1],[1,1],[0,0]]);return r=c.Xtf(r,e.conv.filters,[1,1],"valid"),r=c.jbE(r,e.bn.sub),r=c.lKK(r,e.bn.truediv),t9(r=c.WQq(r,e.conv.bias))})}function ee(t,e){return c.DZQ(function(){var r=c.eVF(t,[[0,0],[1,1],[1,1],[0,0]]);return r=c.wdz(r,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t9(r=c.WQq(r,e.bias))})}!function(t){t[t.XS=224]="XS",t[t.SM=320]="SM",t[t.MD=416]="MD",t[t.LG=608]="LG"}(a||(a={}));var er=function(){function t(t){var e=void 0===t?{}:t,r=e.inputSize,n=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=n||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(t.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),t}(),en=function(t){function e(e){var r=t.call(this,"TinyYolov2")||this;if(!e)throw Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!t7(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every(function(t){return"string"==typeof t}))throw Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map(function(t){return t||{}}).every(function(t){return t7(t.x)&&t7(t.y)}))throw Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(t7)))throw Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb));return r._config=e,r}return h(e,t),Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,e){var r=et(t,e.conv0);return r=et(r=c.jgi(r,[2,2],[2,2],"same"),e.conv1),r=et(r=c.jgi(r,[2,2],[2,2],"same"),e.conv2),r=et(r=c.jgi(r,[2,2],[2,2],"same"),e.conv3),r=et(r=c.jgi(r,[2,2],[2,2],"same"),e.conv4),r=et(r=c.jgi(r,[2,2],[2,2],"same"),e.conv5),r=et(r=c.jgi(r,[2,2],[1,1],"same"),e.conv6),tl(r=et(r,e.conv7),e.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,e){var r=this.config.isFirstLayerConv2d?t9(tl(t,e.conv0,"valid",!1)):ee(t,e.conv0);return r=ee(r=c.jgi(r,[2,2],[2,2],"same"),e.conv1),r=ee(r=c.jgi(r,[2,2],[2,2],"same"),e.conv2),r=ee(r=c.jgi(r,[2,2],[2,2],"same"),e.conv3),r=ee(r=c.jgi(r,[2,2],[2,2],"same"),e.conv4),r=ee(r=c.jgi(r,[2,2],[2,2],"same"),e.conv5),r=c.jgi(r,[2,2],[1,1],"same"),r=e.conv6?ee(r,e.conv6):r,tl(r=e.conv7?ee(r,e.conv7):r,e.conv8,"valid",!1)},e.prototype.forwardInput=function(t,e){var r=this,n=this.params;if(!n)throw Error("TinyYolov2 - load model before inference");return c.DZQ(function(){var o=t.toBatchTensor(e,!1).toFloat();return o=(o=r.config.meanRgb?O(o,r.config.meanRgb):o).div(c.d_2(256)),r.config.withSeparableConvs?r.runMobilenet(o,n):r.runTinyYolov2(o,n)})},e.prototype.forward=function(t,e){return l(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return r=this.forwardInput,[4,to(t)];case 1:return[4,r.apply(this,[n.sent(),e])];case 2:return[2,n.sent()]}})})},e.prototype.detect=function(t,e){return void 0===e&&(e={}),l(this,void 0,void 0,function(){var r,n,o,i,a,s,u,f,h,p,l,v,m=this;return d(this,function(d){switch(d.label){case 0:return n=(r=new er(e)).inputSize,o=r.scoreThreshold,[4,to(t)];case 1:return i=d.sent(),[4,this.forwardInput(i,n)];case 2:return a=d.sent(),s=c.DZQ(function(){return c.K$i(a)[0].expandDims()}),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},[4,this.extractBoxes(s,i.getReshapedInputDimensions(0),o)];case 3:return f=d.sent(),a.dispose(),s.dispose(),h=f.map(function(t){return t.box}),p=f.map(function(t){return t.score}),l=f.map(function(t){return t.classScore}),v=f.map(function(t){return m.config.classes[t.label]}),[2,F(h.map(function(t){return t.rescale(n)}),p,this.config.iouThreshold,!0).map(function(t){return new T(p[t],l[t],v[t],h[t],u)})]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return function(t,e){var r,n=[],o=function(t,e){var r=t_(t,e);function n(t){return{filters:r(t+"/filters",4),bias:r(t+"/bias",1)}}return{extractConvParams:n,extractConvWithBatchNormParams:function(t){var e;return{conv:n(t+"/conv"),bn:{sub:r((e=t+"/bn")+"/sub",1),truediv:r(e+"/truediv",1)}}},extractSeparableConvParams:tb(r)}}(t,n),i=o.extractConvParams,a=o.extractConvWithBatchNormParams,s=o.extractSeparableConvParams;if(e.withSeparableConvs){var c=e.filterSizes&&e.filterSizes.length||9;r={conv0:e.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:c>7?s("conv6"):void 0,conv7:c>8?s("conv7"):void 0,conv8:i("conv8")}}else r={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:i("conv8")};return td(t,n),{params:r,paramMappings:n}}(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,n=r?r.length:void 0;if(7!==n&&8!==n&&9!==n)throw Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+n+" filterSizes in config");return function(t,e,r,n){var o,i,a=tw(t),s=a.extractWeights,u=a.getRemainingWeights,f=[],h={extractConvParams:o=tv(s,f),extractConvWithBatchNormParams:function(t,e,r){var n,i,a;return{conv:o(t,e,3,r+"/conv"),bn:(n=r+"/bn",i=c.tGX(s(e)),a=c.tGX(s(e)),f.push({paramPath:n+"/sub"},{paramPath:n+"/truediv"}),{sub:i,truediv:a})}},extractSeparableConvParams:ty(s,f)},p=h.extractConvParams,l=h.extractConvWithBatchNormParams,d=h.extractSeparableConvParams;if(e.withSeparableConvs){var v=n[0],m=n[1],g=n[2],y=n[3],b=n[4],_=n[5],w=n[6],x=n[7],E=n[8],P=e.isFirstLayerConv2d?p(v,m,3,"conv0"):d(v,m,"conv0"),M=d(m,g,"conv1"),D=d(g,y,"conv2"),S=d(y,b,"conv3"),T=d(b,_,"conv4"),A=d(_,w,"conv5"),F=x?d(w,x,"conv6"):void 0,O=E?d(x,E,"conv7"):void 0,B=p(E||x||w,5*r,1,"conv8");i={conv0:P,conv1:M,conv2:D,conv3:S,conv4:T,conv5:A,conv6:F,conv7:O,conv8:B}}else{var v=n[0],m=n[1],g=n[2],y=n[3],b=n[4],_=n[5],w=n[6],x=n[7],E=n[8],P=l(v,m,"conv0"),M=l(m,g,"conv1"),D=l(g,y,"conv2"),S=l(y,b,"conv3"),T=l(b,_,"conv4"),A=l(_,w,"conv5"),F=l(w,x,"conv6"),O=l(x,E,"conv7"),B=p(E,5*r,1,"conv8");i={conv0:P,conv1:M,conv2:D,conv3:S,conv4:T,conv5:A,conv6:F,conv7:O,conv8:B}}if(0!==u().length)throw Error("weights remaing after extract: "+u().length);return{params:i,paramMappings:f}}(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,e,r){return l(this,void 0,void 0,function(){var n,o,i,a,s,u,f,h,l,v,m,g,y,b,_,w,x,E,P,M,D,T,A,F,O,C,k,I,j,L=this;return d(this,function(d){switch(d.label){case 0:return a=(i=Math.max(n=e.width,o=e.height))/n,s=i/o,u=t.shape[1],f=this.config.anchors.length,l=(h=c.DZQ(function(){var e=t.reshape([u,u,f,L.boxEncodingSize]);return[e.slice([0,0,0,0],[u,u,f,4]),e.slice([0,0,0,4],[u,u,f,1]),L.withClassScores?c.Vs9(e.slice([0,0,0,5],[u,u,f,L.config.classes.length]),3):c.d_2(0)]}))[0],v=h[1],m=h[2],g=[],[4,v.array()];case 1:return y=d.sent(),[4,l.array()];case 2:b=d.sent(),_=0,d.label=3;case 3:if(!(_<u))return[3,12];w=0,d.label=4;case 4:if(!(w<u))return[3,11];x=0,d.label=5;case 5:if(!(x<f))return[3,10];if(E=B(y[_][w][x][0]),!(!r||E>r))return[3,9];if(P=(w+B(b[_][w][x][0]))/u*a,M=(_+B(b[_][w][x][1]))/u*s,D=Math.exp(b[_][w][x][2])*this.config.anchors[x].x/u*a,T=Math.exp(b[_][w][x][3])*this.config.anchors[x].y/u*s,A=P-D/2,F=M-T/2,O={row:_,col:w,anchor:x},!this.withClassScores)return[3,7];return[4,this.extractPredictedClass(m,O)];case 6:return j=d.sent(),[3,8];case 7:j={classScore:1,label:0},d.label=8;case 8:k=(C=j).classScore,I=C.label,g.push(p({box:new S(A,F,A+D,F+T),score:E,classScore:E*k,label:I},O)),d.label=9;case 9:return x++,[3,5];case 10:return w++,[3,4];case 11:return _++,[3,3];case 12:return l.dispose(),v.dispose(),m.dispose(),[2,g]}})})},e.prototype.extractPredictedClass=function(t,e){return l(this,void 0,void 0,function(){var r,n,o,i;return d(this,function(a){switch(a.label){case 0:return r=e.row,n=e.col,o=e.anchor,[4,t.array()];case 1:return i=a.sent(),[2,Array(this.config.classes.length).fill(0).map(function(t,e){return i[r][n][o][e]}).map(function(t,e){return{classScore:t,label:e}}).reduce(function(t,e){return t.classScore>e.classScore?t:e})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e}(tu),eo=function(t){function e(e){void 0===e&&(e=!0);var r=Object.assign({},{withSeparableConvs:e,iouThreshold:.4,classes:["face"]},e?{anchors:t5,meanRgb:t8}:{anchors:t6,withClassScores:!0});return t.call(this,r)||this}return h(e,t),Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return l(this,void 0,void 0,function(){return d(this,function(r){switch(r.label){case 0:return[4,this.detect(t,e)];case 1:return[2,r.sent().map(function(t){return new A(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(en),ei=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return h(e,t),e}(er),ea=function(){function t(){}return t.prototype.then=function(t){return l(this,void 0,void 0,function(){var e;return d(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},t.prototype.run=function(){return l(this,void 0,void 0,function(){return d(this,function(t){throw Error("ComposableTask - run is not implemented")})})},t}();function es(t,e){return Object.assign({},t,{descriptor:e})}function ec(t,e,r,n,o){return void 0===o&&(o=function(t){return t.alignedRect}),l(this,void 0,void 0,function(){var i,a,s,u,f;return d(this,function(h){switch(h.label){case 0:if(i=t.map(function(t){return tk(t)?o(t):t.detection}),s=n)return[3,5];if(!(e instanceof c.qYS))return[3,2];return[4,ta(e,i)];case 1:return u=h.sent(),[3,4];case 2:return[4,ti(e,i)];case 3:u=h.sent(),h.label=4;case 4:s=u,h.label=5;case 5:return[4,r(a=s)];case 6:return f=h.sent(),a.forEach(function(t){return t instanceof c.qYS&&t.dispose()}),[2,f]}})})}function eu(t,e,r,n,o){return l(this,void 0,void 0,function(){var i=this;return d(this,function(a){return[2,ec([t],e,function(t){return l(i,void 0,void 0,function(){return d(this,function(e){return[2,r(t[0])]})})},n,o)]})})}function ef(t,e){return{height:Math.floor(e[0]*t),width:Math.floor(e[1]*t)}}var eh=function(t){function e(e,r,n,o){return t.call(this,{left:e,top:r,right:n,bottom:o},!0)||this}return h(e,t),e}(D);function ep(t){return c.DZQ(function(){return c.lKK(c.jbE(t,c.d_2(127.5)),c.d_2(.0078125))})}function el(t,e){return c.DZQ(function(){return c.WQq(c.VVh(t),c.lKK(e,c.HZy(c.VVh(c.HZy(t)))))})}function ed(t,e,r){return void 0===r&&(r=!1),c.DZQ(function(){var n=tl(t,e.conv1,"valid");return n=el(n,e.prelu1_alpha),n=el(n=tl(n=c.jgi(n,r?[2,2]:[3,3],[2,2],"same"),e.conv2,"valid"),e.prelu2_alpha),n=el(n=tl(n=r?n:c.jgi(n,[3,3],[2,2],"valid"),e.conv3,"valid"),e.prelu3_alpha)})}function ev(t,e,r){var n=r.width,o=r.height;return l(this,void 0,void 0,function(){var r,i,a,s=this;return d(this,function(u){switch(u.label){case 0:return r=G(t),[4,Promise.all(e.map(function(e){return l(s,void 0,void 0,function(){var n,o,i,a,s,c,u,f;return d(this,function(h){return o=(n=e.padAtBorders(t.height,t.width)).y,i=n.ey,a=n.x,s=n.ex,c=a-1,u=o-1,f=r.getImageData(c,u,s-c,i-u),[2,U.isNodejs()?te(f):createImageBitmap(f)]})})}))];case 1:return i=u.sent(),a=[],i.forEach(function(t){var e=G(tt({width:n,height:o}));e.drawImage(t,0,0,n,o);for(var r=e.getImageData(0,0,n,o).data,i=[],s=0;s<r.length;s+=4)i.push(r[s+2]),i.push(r[s+1]),i.push(r[s]);a.push(i)}),[2,a.map(function(t){return c.DZQ(function(){return ep(c.mgz(c.g9W(t,[1,n,o,3]),[0,2,1,3]).toFloat())})})]}})})}var em=function(t){function e(){return t.call(this,"Mtcnn")||this}return h(e,t),e.prototype.load=function(e){return l(this,void 0,void 0,function(){return d(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.load.call(this,e)]})})},e.prototype.loadFromDisk=function(e){return l(this,void 0,void 0,function(){return d(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,t.prototype.loadFromDisk.call(this,e)]})})},e.prototype.forwardInput=function(t,e){return void 0===e&&(e={}),l(this,void 0,void 0,function(){var r,n,o,i,a,s,u,f,h,p,v,m,g,y,b,_,w,x,E,P;return d(this,function(D){switch(D.label){case 0:if(!(r=this.params))throw Error("Mtcnn - load model before inference");if(!(n=t.canvases[0]))throw Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return o={},i=Date.now(),a=c.DZQ(function(){var t;return t=c.UG6(c.TaL.fromPixels(n)).toFloat(),c.DZQ(function(){return c.t$z(c.K$i(t,3).reverse(),3)})}),s=function(t){return a.dispose(),o.total=Date.now()-i,t},f=(u=a.shape.slice(1))[0],h=u[1],v=(p=new t0(e)).minFaceSize,m=p.scaleFactor,g=p.maxNumScales,y=p.scoreThresholds,b=(p.scaleSteps||function(t,e,r){for(var n=r[0],o=r[1],i=12/t,a=[],s=Math.min(n,o)*i,c=0;s>=12;)a.push(i*Math.pow(e,c)),s*=e,c+=1;return a}(v,m,[f,h])).filter(function(t){var e=ef(t,[f,h]);return Math.min(e.width,e.height)>12}).slice(0,g),o.scales=b,o.pyramid=b.map(function(t){return ef(t,[f,h])}),_=Date.now(),[4,function(t,e,r,n,o){o.stage1=[];var i=e.map(function(e){return c.DZQ(function(){var r={scale:e},o=c.DZQ(function(){var r=ef(e,t.shape.slice(1)),n=r.height,o=r.width,i=ep(c.Slp.resizeBilinear(t,[n,o]));return c.mgz(i,[0,2,1,3])}),i=Date.now(),a=c.DZQ(function(){var t=ed(o,n,!0),e=tl(t,n.conv4_1,"valid"),r=c.UG6(c.T9B(e,3),3);return{prob:c.Vs9(c.jbE(e,r),3),regions:tl(t,n.conv4_2,"valid")}}),s=a.prob,u=a.regions;return r.pnet=Date.now()-i,{scoresTensor:c.K$i(c.K$i(s,3)[1])[0],regionsTensor:c.K$i(u)[0],scale:e,statsForScale:r}})}).map(function(t){var e=t.scoresTensor,n=t.regionsTensor,i=t.scale,a=t.statsForScale,s=function(t,e,r,n){for(var o=[],i=t.arraySync(),a=0;a<t.shape[0];a++)for(var s=0;s<t.shape[1];s++)i[a][s]>=n&&o.push(new M(s,a));return o.map(function(t){var n=new S(Math.round((2*t.y+1)/r),Math.round((2*t.x+1)/r),Math.round((2*t.y+12)/r),Math.round((2*t.x+12)/r)),o=i[t.y][t.x],a=e.arraySync();return{cell:n,score:o,region:new eh(a[t.y][t.x][0],a[t.y][t.x][1],a[t.y][t.x][2],a[t.y][t.x][3])}})}(e,n,i,r);if(e.dispose(),n.dispose(),!s.length)return o.stage1.push(a),[];var c=Date.now(),u=F(s.map(function(t){return t.cell}),s.map(function(t){return t.score}),.5);return a.nms=Date.now()-c,a.numBoxes=u.length,o.stage1.push(a),u.map(function(t){return s[t]})}).reduce(function(t,e){return t.concat(e)},[]),a=[],s=[];if(i.length>0){var u=Date.now(),f=F(i.map(function(t){return t.cell}),i.map(function(t){return t.score}),.7);o.stage1_nms=Date.now()-u,s=f.map(function(t){return i[t].score}),a=f.map(function(t){return i[t]}).map(function(t){var e=t.cell,r=t.region;return new S(e.left+r.left*e.width,e.top+r.top*e.height,e.right+r.right*e.width,e.bottom+r.bottom*e.height).toSquare().round()})}return{boxes:a,scores:s}}(a,b,y[0],r.pnet,o)];case 1:if(w=D.sent(),o.total_stage1=Date.now()-_,!w.boxes.length)return[2,s({results:[],stats:o})];return o.stage2_numInputBoxes=w.boxes.length,_=Date.now(),[4,function(t,e,r,n,o){return l(this,void 0,void 0,function(){var i,a,s,u,f,h,p,l,v,m,g,y,b,_;return d(this,function(d){switch(d.label){case 0:return i=Date.now(),[4,ev(t,e,{width:24,height:24})];case 1:return a=d.sent(),o.stage2_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=c.DZQ(function(){var e=ed(t,n),r=el(tD(c.tQQ(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu4_alpha),o=tD(r,n.fc2_1),i=c.UG6(c.T9B(o,1),1),a=c.Vs9(c.jbE(o,i),1),s=tD(r,n.fc2_2);return{scores:c.K$i(a,1)[1],regions:s}});return t.dispose(),e}),o.stage2_rnet=Date.now()-i,u=s.length>1?c.xWs(s.map(function(t){return t.scores})):s[0].scores,p=(h=Array).from,[4,u.data()];case 2:return f=p.apply(h,[d.sent()]),u.dispose(),v=(l=f.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>r}).map(function(t){return t.idx})).map(function(t){return e[t]}),m=l.map(function(t){return f[t]}),g=[],y=[],v.length>0&&(i=Date.now(),b=F(v,m,.7),o.stage2_nms=Date.now()-i,_=b.map(function(t){var e=s[l[t]].regions.arraySync();return new eh(e[0][0],e[0][1],e[0][2],e[0][3])}),y=b.map(function(t){return m[t]}),g=b.map(function(t,e){return v[t].calibrate(_[e])})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose()}),[2,{boxes:g,scores:y}]}})})}(n,w.boxes,y[1],r.rnet,o)];case 2:if(x=D.sent(),o.total_stage2=Date.now()-_,!x.boxes.length)return[2,s({results:[],stats:o})];return o.stage3_numInputBoxes=x.boxes.length,_=Date.now(),[4,function(t,e,r,n,o){return l(this,void 0,void 0,function(){var i,a,s,u,f,h,p,l,v,m,g,y,b,_,w;return d(this,function(d){switch(d.label){case 0:return i=Date.now(),[4,ev(t,e,{width:48,height:48})];case 1:return a=d.sent(),o.stage3_extractImagePatches=Date.now()-i,i=Date.now(),s=a.map(function(t){var e=c.DZQ(function(){var e=ed(t,n);e=el(e=tl(e=c.jgi(e,[2,2],[2,2],"same"),n.conv4,"valid"),n.prelu4_alpha);var r=el(tD(c.tQQ(e,[e.shape[0],n.fc1.weights.shape[0]]),n.fc1),n.prelu5_alpha),o=tD(r,n.fc2_1),i=c.UG6(c.T9B(o,1),1),a=c.Vs9(c.jbE(o,i),1),s=tD(r,n.fc2_2),u=tD(r,n.fc2_3);return{scores:c.K$i(a,1)[1],regions:s,points:u}});return t.dispose(),e}),o.stage3_onet=Date.now()-i,u=s.length>1?c.xWs(s.map(function(t){return t.scores})):s[0].scores,p=(h=Array).from,[4,u.data()];case 2:return f=p.apply(h,[d.sent()]),u.dispose(),v=(l=f.map(function(t,e){return{score:t,idx:e}}).filter(function(t){return t.score>r}).map(function(t){return t.idx})).map(function(t){var e=s[t].regions.arraySync();return new eh(e[0][0],e[0][1],e[0][2],e[0][3])}),m=l.map(function(t,r){return e[t].calibrate(v[r])}),g=l.map(function(t){return f[t]}),y=[],b=[],_=[],m.length>0&&(i=Date.now(),w=F(m,g,.7,!1),o.stage3_nms=Date.now()-i,y=w.map(function(t){return m[t]}),b=w.map(function(t){return g[t]}),_=w.map(function(t,e){return[,,,,,].fill(0).map(function(r,n){var o=s[t].points.arraySync();return new M(o[0][n]*(y[e].width+1)+y[e].left,o[0][n+5]*(y[e].height+1)+y[e].top)})})),s.forEach(function(t){t.regions.dispose(),t.scores.dispose(),t.points.dispose()}),[2,{boxes:y,scores:b,points:_}]}})})}(n,x.boxes,y[2],r.onet,o)];case 3:return E=D.sent(),o.total_stage3=Date.now()-_,P=E.boxes.map(function(t,e){return tI(z({},new A(E.scores[e],new C(t.left/h,t.top/f,t.width/h,t.height/f),{height:f,width:h})),new I(E.points[e].map(function(e){return e.sub(new M(t.left,t.top)).div(new M(t.width,t.height))}),{width:t.width,height:t.height}))}),[2,s({results:P,stats:o})]}})})},e.prototype.forward=function(t,e){return void 0===e&&(e={}),l(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return r=this.forwardInput,[4,to(t)];case 1:return[4,r.apply(this,[n.sent(),e])];case 2:return[2,n.sent().results]}})})},e.prototype.forwardWithStats=function(t,e){return void 0===e&&(e={}),l(this,void 0,void 0,function(){var r;return d(this,function(n){switch(n.label){case 0:return r=this.forwardInput,[4,to(t)];case 1:return[2,r.apply(this,[n.sent(),e])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){var e,r,n,o,i,a,s,c;return n=(r=function(t,e){var r=t_(t,e);function n(t){return{filters:r(t+"/weights",4,t+"/filters"),bias:r(t+"/bias",1)}}function o(t){return{weights:r(t+"/weights",2),bias:r(t+"/bias",1)}}function i(t){return{conv1:n(t+"/conv1"),prelu1_alpha:r(t+"/prelu1_alpha",1),conv2:n(t+"/conv2"),prelu2_alpha:r(t+"/prelu2_alpha",1),conv3:n(t+"/conv3"),prelu3_alpha:r(t+"/prelu3_alpha",1)}}return{extractPNetParams:function(){var t=i("pnet"),e=n("pnet/conv4_1"),r=n("pnet/conv4_2");return p(p({},t),{conv4_1:e,conv4_2:r})},extractRNetParams:function(){var t=i("rnet"),e=o("rnet/fc1"),n=r("rnet/prelu4_alpha",1),a=o("rnet/fc2_1"),s=o("rnet/fc2_2");return p(p({},t),{fc1:e,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i("onet"),e=n("onet/conv4"),a=r("onet/prelu4_alpha",1),s=o("onet/fc1"),c=r("onet/prelu5_alpha",1),u=o("onet/fc2_1"),f=o("onet/fc2_2"),h=o("onet/fc2_3");return p(p({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:f,fc2_3:h})}}}(t,e=[])).extractPNetParams,o=r.extractRNetParams,i=r.extractONetParams,a=n(),s=o(),c=i(),td(t,e),{params:{pnet:a,rnet:s,onet:c},paramMappings:e}},e.prototype.extractParams=function(t){return function(t){var e=tw(t),r=e.extractWeights,n=e.getRemainingWeights,o=[],i=function(t,e){var r=tv(t,e),n=tm(t,e);function o(r,n){var o=c.tGX(t(r));return e.push({paramPath:n}),o}function i(t,e,n){return void 0===n&&(n=!1),{conv1:r(t[0],t[1],3,e+"/conv1"),prelu1_alpha:o(t[1],e+"/prelu1_alpha"),conv2:r(t[1],t[2],3,e+"/conv2"),prelu2_alpha:o(t[2],e+"/prelu2_alpha"),conv3:r(t[2],t[3],n?2:3,e+"/conv3"),prelu3_alpha:o(t[3],e+"/prelu3_alpha")}}return{extractPNetParams:function(){var t=i([3,10,16,32],"pnet"),e=r(32,2,1,"pnet/conv4_1"),n=r(32,4,1,"pnet/conv4_2");return p(p({},t),{conv4_1:e,conv4_2:n})},extractRNetParams:function(){var t=i([3,28,48,64],"rnet",!0),e=n(576,128,"rnet/fc1"),r=o(128,"rnet/prelu4_alpha"),a=n(128,2,"rnet/fc2_1"),s=n(128,4,"rnet/fc2_2");return p(p({},t),{fc1:e,prelu4_alpha:r,fc2_1:a,fc2_2:s})},extractONetParams:function(){var t=i([3,32,64,64],"onet"),e=r(64,128,2,"onet/conv4"),a=o(128,"onet/prelu4_alpha"),s=n(1152,256,"onet/fc1"),c=o(256,"onet/prelu5_alpha"),u=n(256,2,"onet/fc2_1"),f=n(256,4,"onet/fc2_2"),h=n(256,10,"onet/fc2_3");return p(p({},t),{conv4:e,prelu4_alpha:a,fc1:s,prelu5_alpha:c,fc2_1:u,fc2_2:f,fc2_3:h})}}}(r,o),a=i.extractPNetParams,s=i.extractRNetParams,u=i.extractONetParams,f=a(),h=s(),l=u();if(0!==n().length)throw Error("weights remaing after extract: "+n().length);return{params:{pnet:f,rnet:h,onet:l},paramMappings:o}}(t)},e}(tu),eg=[new M(1.603231,2.094468),new M(6.041143,7.080126),new M(2.882459,3.518061),new M(4.266906,5.178857),new M(9.041765,10.66308)],ey=[117.001,114.697,97.404],eb=function(t){function e(){return t.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:eg,meanRgb:ey,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return h(e,t),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,e){return l(this,void 0,void 0,function(){return d(this,function(r){switch(r.label){case 0:return[4,this.detect(t,e)];case 1:return[2,r.sent().map(function(t){return new A(t.score,t.relativeBox,{width:t.imageWidth,height:t.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(e){return t.prototype.extractParamsFromWeigthMap.call(this,e)},e}(en),e_={ssdMobilenetv1:new t3,tinyFaceDetector:new eb,tinyYolov2:new eo,mtcnn:new em,faceLandmark68Net:new tU,faceLandmark68TinyNet:new tG,faceRecognitionNet:new tY,faceExpressionNet:new tO,ageGenderNet:new tQ};function ew(t,e){return Object.assign({},t,{age:e})}var ex=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=n,o}return h(e,t),e}(ea),eE=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e,r=this;return d(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return[4,ec(t=n.sent(),this.input,function(t){return l(r,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return e_.faceExpressionNet.predictExpressions(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=n.sent(),[2,t.map(function(t,r){return tB(t,e[r])})]}})})},e.prototype.withAgeAndGender=function(){return new eT(this,this.input)},e}(ex),eP=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e;return d(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:if(!(t=r.sent()))return[2];return[4,eu(t,this.input,function(t){return e_.faceExpressionNet.predictExpressions(t)},this.extractedFaces)];case 2:return e=r.sent(),[2,tB(t,e)]}})})},e.prototype.withAgeAndGender=function(){return new eA(this,this.input)},e}(ex),eM=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.withAgeAndGender=function(){return new eF(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eC(this,this.input)},e}(eE),eD=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.withAgeAndGender=function(){return new eO(this,this.input)},e.prototype.withFaceDescriptor=function(){return new ek(this,this.input)},e}(eP),eS=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=n,o}return h(e,t),e}(ea),eT=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e,r=this;return d(this,function(n){switch(n.label){case 0:return[4,this.parentTask];case 1:return[4,ec(t=n.sent(),this.input,function(t){return l(r,void 0,void 0,function(){return d(this,function(e){switch(e.label){case 0:return[4,Promise.all(t.map(function(t){return e_.ageGenderNet.predictAgeAndGender(t)}))];case 1:return[2,e.sent()]}})})},this.extractedFaces)];case 2:return e=n.sent(),[2,t.map(function(t,r){var n=e[r],o=n.age;return ew(tJ(t,n.gender,n.genderProbability),o)})]}})})},e.prototype.withFaceExpressions=function(){return new eE(this,this.input)},e}(eS),eA=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e,r,n,o;return d(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:if(!(t=i.sent()))return[2];return[4,eu(t,this.input,function(t){return e_.ageGenderNet.predictAgeAndGender(t)},this.extractedFaces)];case 2:return r=(e=i.sent()).age,n=e.gender,o=e.genderProbability,[2,ew(tJ(t,n,o),r)]}})})},e.prototype.withFaceExpressions=function(){return new eP(this,this.input)},e}(eS),eF=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.withFaceExpressions=function(){return new eM(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eC(this,this.input)},e}(eT),eO=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.withFaceExpressions=function(){return new eD(this,this.input)},e.prototype.withFaceDescriptor=function(){return new ek(this,this.input)},e}(eA),eB=function(t){function e(e,r){var n=t.call(this)||this;return n.parentTask=e,n.input=r,n}return h(e,t),e}(ea),eC=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t;return d(this,function(e){switch(e.label){case 0:return[4,this.parentTask];case 1:return[4,ec(t=e.sent(),this.input,function(t){return Promise.all(t.map(function(t){return e_.faceRecognitionNet.computeFaceDescriptor(t)}))},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return[2,e.sent().map(function(e,r){return es(t[r],e)})]}})})},e.prototype.withFaceExpressions=function(){return new eM(this,this.input)},e.prototype.withAgeAndGender=function(){return new eF(this,this.input)},e}(eB),ek=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e;return d(this,function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:if(!(t=r.sent()))return[2];return[4,eu(t,this.input,function(t){return e_.faceRecognitionNet.computeFaceDescriptor(t)},null,function(t){return t.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return e=r.sent(),[2,es(t,e)]}})})},e.prototype.withFaceExpressions=function(){return new eD(this,this.input)},e.prototype.withAgeAndGender=function(){return new eO(this,this.input)},e}(eB),eI=function(t){function e(e,r,n){var o=t.call(this)||this;return o.parentTask=e,o.input=r,o.useTinyLandmarkNet=n,o}return h(e,t),Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?e_.faceLandmark68TinyNet:e_.faceLandmark68Net},enumerable:!0,configurable:!0}),e}(ea),ej=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e,r,n,o,i=this;return d(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:if(e=(t=a.sent()).map(function(t){return t.detection}),!(this.input instanceof c.qYS))return[3,3];return[4,ta(this.input,e)];case 2:return n=a.sent(),[3,5];case 3:return[4,ti(this.input,e)];case 4:n=a.sent(),a.label=5;case 5:return[4,Promise.all((r=n).map(function(t){return i.landmarkNet.detectLandmarks(t)}))];case 6:return o=a.sent(),r.forEach(function(t){return t instanceof c.qYS&&t.dispose()}),[2,t.map(function(t,e){return tI(t,o[e])})]}})})},e.prototype.withFaceExpressions=function(){return new eM(this,this.input)},e.prototype.withAgeAndGender=function(){return new eF(this,this.input)},e.prototype.withFaceDescriptors=function(){return new eC(this,this.input)},e}(eI),eL=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e,r,n,o;return d(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:if(!(t=i.sent()))return[2];if(e=t.detection,!(this.input instanceof c.qYS))return[3,3];return[4,ta(this.input,[e])];case 2:return n=i.sent(),[3,5];case 3:return[4,ti(this.input,[e])];case 4:n=i.sent(),i.label=5;case 5:return r=n,[4,this.landmarkNet.detectLandmarks(r[0])];case 6:return o=i.sent(),r.forEach(function(t){return t instanceof c.qYS&&t.dispose()}),[2,tI(t,o)]}})})},e.prototype.withFaceExpressions=function(){return new eD(this,this.input)},e.prototype.withAgeAndGender=function(){return new eO(this,this.input)},e.prototype.withFaceDescriptor=function(){return new ek(this,this.input)},e}(eI),eW=function(t){function e(e,r){void 0===r&&(r=new t4);var n=t.call(this)||this;return n.input=e,n.options=r,n}return h(e,t),e}(ea),eN=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e,r,n;return d(this,function(o){switch(o.label){case 0:if(t=this,e=t.input,!((r=t.options)instanceof t0))return[3,2];return[4,e_.mtcnn.forward(e,r)];case 1:return[2,o.sent().map(function(t){return t.detection})];case 2:if(!(n=r instanceof ei?function(t){return e_.tinyFaceDetector.locateFaces(t,r)}:r instanceof t4?function(t){return e_.ssdMobilenetv1.locateFaces(t,r)}:r instanceof er?function(t){return e_.tinyYolov2.locateFaces(t,r)}:null))throw Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,n(e)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(e){return l(t,void 0,void 0,function(){return d(this,function(t){switch(t.label){case 0:return[4,this.run()];case 1:return[2,e(t.sent().map(function(t){return z({},t)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new ej(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new eE(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new eT(this.runAndExtendWithFaceDetections(),this.input)},e}(eW);function eR(t,e){return void 0===e&&(e=new t4),new eN(t,e)}function ez(t,e){if(t.length!==e.length)throw Error("euclideanDistance: arr1.length !== arr2.length");var r=Array.from(t),n=Array.from(e);return Math.sqrt(r.map(function(t,e){return t-n[e]}).reduce(function(t,e){return t+Math.pow(e,2)},0))}!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}h(e,t),e.prototype.run=function(){return l(this,void 0,void 0,function(){var t,e;return d(this,function(r){switch(r.label){case 0:return[4,new eN(this.input,this.options)];case 1:return e=(t=r.sent())[0],t.forEach(function(t){t.score>e.score&&(e=t)}),[2,e]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(e){return l(t,void 0,void 0,function(){var t;return d(this,function(r){switch(r.label){case 0:return[4,this.run()];case 1:return[2,e((t=r.sent())?z({},t):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return void 0===t&&(t=!1),new eL(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new eP(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new eA(this.runAndExtendWithFaceDetection(),this.input)}}(eW),function(){function t(t,e){void 0===e&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw Error("FaceRecognizer.constructor - expected atleast one input");var n=1,o=function(){return"person "+n++};this._labeledDescriptors=r.map(function(t){if(t instanceof N)return t;if(t instanceof Float32Array)return new N(o(),[t]);if(t.descriptor&&t.descriptor instanceof Float32Array)return new N(o(),[t.descriptor]);throw Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}Object.defineProperty(t.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),t.prototype.computeMeanDistance=function(t,e){return e.map(function(e){return ez(e,t)}).reduce(function(t,e){return t+e},0)/(e.length||1)},t.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){var n=r.descriptors;return new L(r.label,e.computeMeanDistance(t,n))}).reduce(function(t,e){return t.distance<e.distance?t:e})},t.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new L("unknown",e.distance)},t.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},t.fromJSON=function(e){return new t(e.labeledDescriptors.map(function(t){return N.fromJSON(t)}),e.distanceThreshold)}}()}}]);